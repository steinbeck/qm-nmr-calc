# Requirements Archive: v2.7 Automated GCP Deployment

**Defined:** 2026-02-06
**Completed:** 2026-02-06
**Core Value:** Reliable async NMR predictions with full control over calculation parameters -- submit a molecule, get back accurate 1H/13C shifts without babysitting long-running calculations.

## v2.7 Requirements

Requirements for v2.7 milestone. Each maps to roadmap phases.

### Configuration

- [x] **CFG-01**: User specifies compute requirements (CPU cores, RAM) in a TOML config file
- [x] **CFG-02**: Config file specifies GCP project ID and resource prefix
- [x] **CFG-03**: Config file specifies persistent disk size
- [x] **CFG-04**: Config validated with clear error messages before any GCP operations (Pydantic)
- [x] **CFG-05**: Invalid config (missing project, impossible CPU/RAM combos) rejected with actionable error messages

### Pricing and Region Selection

- [x] **PRC-01**: System queries spot pricing across all GCP regions automatically
- [x] **PRC-02**: System selects cheapest region/zone for the requested machine spec
- [x] **PRC-03**: Pricing data cached with TTL to avoid redundant API calls
- [x] **PRC-04**: Hardcoded regional fallback rankings used when pricing API unavailable
- [x] **PRC-05**: Cost estimate displayed before deployment begins

### Machine Selection

- [x] **MCH-01**: System maps CPU/RAM requirements to appropriate GCP machine type
- [x] **MCH-02**: Machine type availability validated in target zone before creation
- [x] **MCH-03**: System falls back to next-cheapest region if primary zone lacks capacity
- [x] **MCH-04**: Docker resource limits (memory, CPU) calculated dynamically from selected machine type

### Deployment

- [x] **DEP-01**: Single command deploys end-to-end with zero interactive prompts
- [x] **DEP-02**: Deployment uses `--quiet` and explicit parameters for all gcloud commands
- [x] **DEP-03**: Infrastructure operations are idempotent (create if missing, reuse if exists)
- [x] **DEP-04**: VM created as Spot instance with correct machine type and static IP
- [x] **DEP-05**: Startup script dynamically generated with computed NWCHEM_NPROC and WORKER_MEMORY_LIMIT
- [x] **DEP-06**: Deployment serves HTTP only on port 80 (no HTTPS, no domain, no certificates)
- [x] **DEP-07**: Deployment progress displayed with timestamped feedback
- [x] **DEP-08**: Failed deployment cleans up orphaned resources (VMs, disks)
- [x] **DEP-09**: Dry-run mode (--dry-run) shows planned actions without executing

### Lifecycle

- [x] **LCY-01**: Existing lifecycle scripts (start, stop, delete, status, ssh, logs) continue to work
- [x] **LCY-02**: Teardown script removes all created resources cleanly

### V2.6 Replacement

- [x] **RPL-01**: New automation replaces v2.6 interactive deploy-vm.sh
- [x] **RPL-02**: No interactive prompts anywhere in deployment flow
- [x] **RPL-03**: DNS check and domain requirement removed entirely
- [x] **RPL-04**: HTTPS/Caddy TLS configuration removed from GCP deployment

### Bug Fix

- [x] **BUG-01**: Conformer progress tracking display updates correctly during processing
- [x] **BUG-02**: Status bar shows accurate conformer count (e.g., "1/2" not "0/2") as conformers complete

## Deferred Requirements

Not in v2.7 scope. Tracked for future consideration.

### Auto-Recovery

- **REC-01**: Automatic VM restart after spot preemption
- **REC-02**: Calculation checkpointing for resume after preemption

### Monitoring

- **MON-01**: Health checks for running containers
- **MON-02**: Cost tracking and billing alerts

### Security

- **SEC-01**: HTTPS support with domain-based TLS certificates
- **SEC-02**: Authentication for web UI access

## Out of Scope

| Feature | Reason |
|---------|--------|
| Auto-scaling | Single-instance pattern, no horizontal scaling needed |
| Terraform/IaC | Overkill for single VM deployment |
| Kubernetes/Helm | Single VM, Docker Compose sufficient |
| Auto-recovery on preemption | User controls lifecycle manually |
| HTTPS/TLS | Fire-up-and-burn pattern, bare IP only |
| Real-time billing | GCP billing lags 1-2 days, use estimates |
| Multi-VM orchestration | Single VM design |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| CFG-01 | 49 | Done |
| CFG-02 | 49 | Done |
| CFG-03 | 49 | Done |
| CFG-04 | 49 | Done |
| CFG-05 | 49 | Done |
| PRC-01 | 49 | Done |
| PRC-02 | 50 | Done |
| PRC-03 | 49 | Done |
| PRC-04 | 49 | Done |
| PRC-05 | 51 | Done |
| MCH-01 | 50 | Done |
| MCH-02 | 50 | Done |
| MCH-03 | 50 | Done |
| MCH-04 | 50 | Done |
| DEP-01 | 51 | Done |
| DEP-02 | 51 | Done |
| DEP-03 | 51 | Done |
| DEP-04 | 51 | Done |
| DEP-05 | 51 | Done |
| DEP-06 | 52 | Done |
| DEP-07 | 51 | Done |
| DEP-08 | 51 | Done |
| DEP-09 | 51 | Done |
| LCY-01 | 52 | Done |
| LCY-02 | 52 | Done |
| RPL-01 | 51 | Done |
| RPL-02 | 51 | Done |
| RPL-03 | 51 | Done |
| RPL-04 | 52 | Done |
| BUG-01 | 53 | Done |
| BUG-02 | 53 | Done |

**Coverage:**
- v2.7 requirements: 31 total
- Satisfied: 31
- Unsatisfied: 0

---
*Archived: 2026-02-06*
