# Milestone v2.3: NMReData Export

**Status:** ✅ SHIPPED 2026-02-01
**Phases:** 32-34
**Total Plans:** 3

## Overview

Enable machine-readable export of NMR prediction results in the NMReData standard format for interoperability with NMR analysis tools.

## Phases

### Phase 32: Core NMReData Generation Module

**Goal**: Generate NMReData-compliant SDF files with predicted chemical shifts and optimized geometry
**Depends on**: Phase 31 (v2.2 complete)
**Requirements**: NMRD-01, NMRD-02, NMRD-03, NMRD-04, NMRD-05, NMRD-06, NMRD-07, NMRD-08, NMRD-09
**Success Criteria** (what must be TRUE):
  1. User can generate NMReData SDF file containing valid MOL block with optimized 3D coordinates
  2. Generated file includes required metadata tags (VERSION 1.1 or 2.0, LEVEL 0, SOLVENT with proper mapping, TEMPERATURE 298.15 K)
  3. Generated file includes ASSIGNMENT tag with 1H and 13C chemical shifts mapped to 1-indexed atom numbers
  4. Generated file includes molecular identifiers (FORMULA, SMILES tags)
  5. Generated file includes provenance metadata (calculation method, basis set, scaling factors applied)
  6. Atom numbering conversion (RDKit 0-indexed → SDF 1-indexed) handled correctly with no off-by-one errors
  7. Tag separator format (", " comma+space) compliant with NMReData specification
  8. Ensemble calculations export Boltzmann-weighted average shifts with lowest-energy conformer geometry
**Plans**: 1 plan

Plans:
- [x] 32-01-PLAN.md — Core NMReData module with tag formatting and generate_nmredata_sdf()

### Phase 33: API and UI Integration

**Goal**: Enable NMReData file download via REST API endpoint and web UI button
**Depends on**: Phase 32
**Requirements**: API-01, API-02, API-03, UI-01
**Success Criteria** (what must be TRUE):
  1. User can download NMReData file via GET /api/v1/jobs/{job_id}/nmredata.sdf endpoint
  2. Response includes proper HTTP headers (media type chemical/x-mdl-sdfile, filename {job_id}_nmredata.sdf)
  3. Endpoint returns 404 if job not found, 409 if job not complete
  4. Results page includes NMReData download button alongside existing PNG/XYZ downloads
  5. Download button follows existing glassmorphism design system from v2.1
**Plans**: 1 plan

Plans:
- [x] 33-01-PLAN.md — NMReData endpoint and download button

### Phase 34: Testing and Validation

**Goal**: Comprehensive testing of NMReData format compliance and round-trip validation
**Depends on**: Phase 33
**Requirements**: TEST-01, TEST-02, TEST-03
**Success Criteria** (what must be TRUE):
  1. Unit tests validate NMReData tag formatting (separators, atom numbering conversion, solvent mapping)
  2. Integration tests validate complete API endpoint flow (job completion check, file generation, HTTP response)
  3. Exported file can be parsed by RDKit SDMolSupplier without errors
  4. Round-trip test verifies atom assignments match original predictions after re-import
  5. Test coverage includes edge cases (ensemble vs single-conformer, different solvents, molecules with implicit hydrogens)
**Plans**: 1 plan

Plans:
- [x] 34-01-PLAN.md — NMReData endpoint integration tests

---

## Milestone Summary

**Key Decisions:**

- Lowercase atom labels (h5, c3) for NMReData format
- Preserve 1-based atom indices from NWChem (no conversion needed)
- Solvent mapping: chcl3→CDCl3, dmso→(CD3)2SO
- 4 decimal precision for shifts per NMReData spec
- NMReData button placed after Geometry (SDF) to group SDF downloads together
- Temperature defaults to 298.15 K (single) or ensemble temperature (ensemble mode)

**Issues Resolved:**

- None — clean implementation following established patterns

**Issues Deferred:**

- NMRD-10: NMREDATA_INCHI tag (future enhancement)
- NMRD-11: NMREDATA_1D_1H/13C pseudo-spectrum tags (future enhancement)
- NMRD-12: Per-conformer export (limited NMReData multi-conformer support)
- NMRD-13: NMREDATA_J coupling constants (requires additional QM calculation)

**Technical Debt Incurred:**

- None — feature is self-contained

---

_For current project status, see .planning/ROADMAP.md_
