---
phase: 22-responsive-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/qm_nmr_calc/api/static/css/tokens.css
  - src/qm_nmr_calc/api/static/css/components/glass-card.css
autonomous: true

must_haves:
  truths:
    - "Hover effects only appear on devices with mouse/trackpad (not touch devices)"
    - "Card hover transitions run at 60fps without jank"
    - "Touch devices show press feedback on active state"
    - "Users with reduced motion preference see opacity-based transitions instead of transform"
    - "Tablet breakpoint (768-1024px) uses intermediate gap value (16px)"
  artifacts:
    - path: "src/qm_nmr_calc/api/static/css/tokens.css"
      provides: "Tablet breakpoint token override"
      contains: "@media (min-width: 768px)"
    - path: "src/qm_nmr_calc/api/static/css/components/glass-card.css"
      provides: "Touch-safe hover, GPU shadow, reduced motion support"
      contains: "pointer: fine"
  key_links:
    - from: "glass-card.css"
      to: "tokens.css"
      via: "CSS custom properties"
      pattern: "var\\(--transition"
---

<objective>
Implement touch-safe hover states, GPU-accelerated shadow animations, and reduced motion support for glass cards.

Purpose: Ensures smooth 60fps animations on all devices, prevents sticky hover on touch screens, and provides accessible alternatives for users with motion sensitivity.

Output: Updated tokens.css with tablet breakpoint, updated glass-card.css with touch-safe hover, GPU shadow animation, touch press states, and reduced motion support.
</objective>

<execution_context>
@/home/chris/.claude/get-shit-done/workflows/execute-plan.md
@/home/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-responsive-polish/22-RESEARCH.md

# Source files to modify
@src/qm_nmr_calc/api/static/css/tokens.css
@src/qm_nmr_calc/api/static/css/components/glass-card.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add tablet breakpoint token and reduced motion token</name>
  <files>src/qm_nmr_calc/api/static/css/tokens.css</files>
  <action>
Add a tablet breakpoint override between the existing mobile and desktop defaults in tokens.css:

1. Add new media query for tablet breakpoint (768px to 1024px) after line 109:
   ```css
   /* Tablet overrides */
   @media (min-width: 768px) and (max-width: 1024px) {
       :root {
           --bento-gap: 1rem;  /* 16px tablet (between 12px mobile and 24px desktop) */
           --glass-blur-light: blur(8px);
           --glass-blur-medium: blur(10px);
       }
   }
   ```

2. Add reduced motion token near the transitions section (around line 94):
   ```css
   /* Reduced motion transition - faster, no transform-based motion */
   --transition-reduced: 200ms ease;
   ```

The existing mobile override uses max-width: 768px, so the new tablet query fits cleanly between.
  </action>
  <verify>
Verify tokens.css has:
- `@media (min-width: 768px) and (max-width: 1024px)` block with `--bento-gap: 1rem`
- `--transition-reduced` variable defined in :root
  </verify>
  <done>Tablet breakpoint gap scales 12px (mobile) -> 16px (tablet) -> 24px (desktop). Reduced motion token available for other components.</done>
</task>

<task type="auto">
  <name>Task 2: Implement touch-safe hover and GPU-accelerated shadow</name>
  <files>src/qm_nmr_calc/api/static/css/components/glass-card.css</files>
  <action>
Update glass-card.css to fix hover and shadow performance:

1. **Update base .glass-card transition** (around line 39-41): Change from animating box-shadow directly to using will-change hint:
   ```css
   /* Performance-friendly animations */
   transition: transform var(--transition-base, 250ms ease);
   will-change: transform;
   ```

2. **Add pseudo-element for GPU-accelerated shadow** after line 42 inside .glass-card block:
   ```css
   /* Pseudo-element for GPU-accelerated shadow animation */
   position: relative;
   ```

   Then add a new block after .glass-card definition (before elements):
   ```css
   .glass-card::after {
       content: '';
       position: absolute;
       inset: 0;
       border-radius: inherit;
       box-shadow: 0 12px 48px hsl(0 0% 0% / 0.2);
       opacity: 0;
       transition: opacity var(--transition-base, 250ms ease);
       pointer-events: none;
       z-index: -1;
   }
   ```

3. **Update hover media query** (lines 95-101): Add `and (pointer: fine)` for touch safety, animate pseudo-element opacity:
   ```css
   /* ===== Interactive hover (desktop only - touch-safe) ===== */
   @media (hover: hover) and (pointer: fine) {
       .glass-card--interactive:hover {
           transform: translateY(-4px);
           cursor: pointer;
       }

       .glass-card--interactive:hover::after {
           opacity: 1;
       }

       .glass-card--interactive:active {
           transform: translateY(-2px);
       }
   }
   ```

4. **Add touch device active states** after the hover media query:
   ```css
   /* ===== Touch device press feedback ===== */
   @media (hover: none) {
       .glass-card--interactive:active {
           transform: scale(0.98);
           opacity: 0.95;
       }
   }
   ```

5. **Add reduced motion support** after the touch device block:
   ```css
   /* ===== Accessibility: Reduced motion ===== */
   @media (prefers-reduced-motion: reduce) {
       .glass-card {
           transition: none;
       }

       .glass-card::after {
           transition: opacity var(--transition-reduced, 200ms ease);
       }

       .glass-card--interactive:hover,
       .glass-card--interactive:active {
           transform: none;
       }
   }
   ```

Remove the old `box-shadow: 0 12px 48px hsl(0 0% 0% / 0.2);` from the hover state since shadow is now handled by pseudo-element opacity.
  </action>
  <verify>
Run: `grep -n "pointer: fine" src/qm_nmr_calc/api/static/css/components/glass-card.css`
Expected: Line with `@media (hover: hover) and (pointer: fine)`

Run: `grep -n "prefers-reduced-motion" src/qm_nmr_calc/api/static/css/components/glass-card.css`
Expected: Line with `@media (prefers-reduced-motion: reduce)`

Run: `grep -n "hover: none" src/qm_nmr_calc/api/static/css/components/glass-card.css`
Expected: Line with `@media (hover: none)` for touch press states
  </verify>
  <done>
Glass cards have:
- Touch-safe hover (only on devices with fine pointer)
- GPU-accelerated shadow via pseudo-element opacity animation
- Touch press feedback on touch devices
- Reduced motion support that keeps visual feedback without transform motion
  </done>
</task>

</tasks>

<verification>
1. CSS syntax validation:
   - No CSS parsing errors in browser DevTools
   - Both files load without errors

2. Hover behavior check:
   - Desktop: Cards lift on hover with shadow transition
   - Touch simulator: No sticky hover states after tap

3. Reduced motion check:
   - Enable `prefers-reduced-motion: reduce` in DevTools
   - Cards should not lift on hover, only shadow opacity changes
</verification>

<success_criteria>
- [ ] tokens.css has tablet breakpoint with --bento-gap: 1rem
- [ ] tokens.css has --transition-reduced variable
- [ ] glass-card.css hover query includes `and (pointer: fine)`
- [ ] glass-card.css has ::after pseudo-element for shadow
- [ ] glass-card.css has `@media (hover: none)` with :active states
- [ ] glass-card.css has `@media (prefers-reduced-motion: reduce)` block
- [ ] No CSS syntax errors
</success_criteria>

<output>
After completion, create `.planning/phases/22-responsive-polish/22-01-SUMMARY.md`
</output>
