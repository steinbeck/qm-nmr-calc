---
phase: 27-usage-guide
plan: 02
type: execute
wave: 2
depends_on: ["01"]
files_modified:
  - docs/usage.md
autonomous: true

must_haves:
  truths:
    - "User can submit jobs via curl commands using documentation examples"
    - "User can poll job status and retrieve results programmatically"
    - "User understands what each API response field means"
    - "User can interpret NMR shift tables and spectrum visualizations"
  artifacts:
    - path: "docs/usage.md"
      provides: "REST API reference and result interpretation guide"
      contains: "## REST API Reference"
      min_lines: 400
  key_links:
    - from: "docs/usage.md"
      to: "/api/v1/jobs"
      via: "API endpoint documentation"
      pattern: "POST.*api/v1/jobs"
---

<objective>
Document the REST API endpoints with curl examples and provide a comprehensive result interpretation guide for the QM NMR Calculator.

Purpose: Enable developers to integrate with the API programmatically and help all users understand how to interpret calculation results.

Output: Updated docs/usage.md with REST API Reference section (all endpoints with curl examples) and Result Interpretation section (shifts, spectra, 3D viewer, downloads).
</objective>

<execution_context>
@/home/chris/.claude/get-shit-done/workflows/execute-plan.md
@/home/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

# Source files for accurate API documentation
@src/qm_nmr_calc/api/routers/jobs.py
@src/qm_nmr_calc/api/routers/health.py
@src/qm_nmr_calc/api/schemas.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: REST API Reference Documentation</name>
  <files>docs/usage.md</files>
  <action>
Append to docs/usage.md (after the content from Plan 01) the REST API Reference section:

**REST API Reference** (~150 lines) - USAGE-02

1. **Overview**
   - Base URL: `http://localhost:8000/api/v1`
   - No authentication required (local deployment)
   - JSON request/response format
   - Async workflow: submit returns 202, poll for completion

2. **Health Endpoints**
   - `GET /health` - Liveness probe (minimal, just {"status": "alive"})
   - `GET /health/ready` - Readiness probe with component checks
     - Example response showing data_directory, task_queue, crest_available

3. **Job Submission**
   - `POST /api/v1/jobs` - Submit via JSON
     - Full curl example with all parameters
     - Request body schema explanation
     - Response: 202 Accepted with job_id, Location header
   - `POST /api/v1/jobs/upload` - Submit via file upload
     - Multipart form example with curl
     - Accepts .mol and .sdf files
   - `GET /api/v1/jobs/solvents` - List available solvents

4. **Job Status**
   - `GET /api/v1/jobs/{job_id}` - Get job status
     - Example responses for: pending, running, complete, failed
     - Explain key fields: status, current_step, conformer_progress
     - Show polling pattern with sleep

5. **Results Retrieval** (requires status=complete)
   - `GET /api/v1/jobs/{job_id}/results` - NMR shifts JSON
     - Full response example with h1_shifts, c13_shifts arrays
     - Explain scaling_factor_source and expected_mae fields
   - `GET /api/v1/jobs/{job_id}/geometry` - Optimized XYZ
   - `GET /api/v1/jobs/{job_id}/geometry.sdf` - Optimized SDF with bonds
   - `GET /api/v1/jobs/{job_id}/geometry.json` - 3D viewer data (includes SDF + assignments)
   - `GET /api/v1/jobs/{job_id}/output` - Raw NWChem output (ZIP)
   - `GET /api/v1/jobs/{job_id}/spectrum/1h.png` - 1H spectrum PNG
   - `GET /api/v1/jobs/{job_id}/spectrum/1h.svg` - 1H spectrum SVG
   - `GET /api/v1/jobs/{job_id}/spectrum/13c.png` - 13C spectrum PNG
   - `GET /api/v1/jobs/{job_id}/spectrum/13c.svg` - 13C spectrum SVG
   - `GET /api/v1/jobs/{job_id}/structure.png` - Annotated structure PNG
   - `GET /api/v1/jobs/{job_id}/structure.svg` - Annotated structure SVG

6. **Error Handling**
   - HTTP status codes: 202 (accepted), 200 (ok), 404 (not found), 409 (not complete), 422 (validation error)
   - Problem detail format (RFC 7807)
   - Example error response

7. **Complete Workflow Example**
   - Full bash script showing: submit -> poll -> download results
   - Use jq for JSON parsing
   - Include timeout/retry logic

Ensure all curl examples are copy-paste ready with realistic values.
  </action>
  <verify>
```bash
# Verify API section exists with endpoints
grep -E "## REST API Reference" docs/usage.md

# Verify key endpoints documented
grep -c "curl" docs/usage.md
# Should have at least 10 curl examples

# Verify all major endpoints mentioned
grep -E "POST /api/v1/jobs|GET /api/v1/jobs|/results|/geometry|/spectrum" docs/usage.md | wc -l
# Should match at least 8 endpoints
```
  </verify>
  <done>
REST API Reference section added with:
- All endpoints documented with curl examples
- Request/response schemas explained
- Complete workflow example
- Error handling guidance
  </done>
</task>

<task type="auto">
  <name>Task 2: Result Interpretation Guide</name>
  <files>docs/usage.md</files>
  <action>
Append to docs/usage.md the Result Interpretation section:

**Result Interpretation** (~100 lines) - USAGE-06

1. **Chemical Shift Tables**
   - 1H shifts: range typically 0-12 ppm for organic molecules
   - 13C shifts: range typically 0-220 ppm
   - Atom indices match the canonical SMILES ordering
   - Units are ppm relative to TMS reference

2. **Expected Accuracy**
   - 1H shifts: MAE ~0.2-0.3 ppm (production), ~0.5-1.0 ppm (draft)
   - 13C shifts: MAE ~2-4 ppm (production), ~5-8 ppm (draft)
   - Scaling factors from DELTA50 benchmark dataset
   - Note: Accuracy depends on molecule type and conformer sampling

3. **Spectrum Visualizations**
   - X-axis: chemical shift (ppm), reversed (high to low)
   - Peaks: Lorentzian line shapes centered at predicted shifts
   - 1H spectrum: 0-12 ppm range typically
   - 13C spectrum: 0-220 ppm range
   - Click to enlarge in web UI

4. **3D Structure Viewer**
   - Interactive rotation (click + drag)
   - Zoom (scroll)
   - Shift labels: blue for 1H, orange for 13C
   - Ball-and-stick model with Jmol colors
   - For ensemble: labels show Boltzmann-averaged shifts
   - Conformer dropdown: view different conformer geometries

5. **Ensemble Results**
   - Shifts are population-weighted averages
   - Ensemble metadata shows:
     - Conformer count (how many contributed to average)
     - Energy range (spread in kcal/mol)
     - Top contributors (highest population conformers)
   - Temperature: 298.15 K (room temperature)

6. **Downloading Results**
   - XYZ: Cartesian coordinates (simple, universal)
   - SDF: Structure with bonds (better for visualization tools)
   - ZIP: Raw NWChem output files (for debugging/reproducibility)
   - PNG/SVG: Spectrum images for publications
   - Recommended: SDF for structure, SVG for publication figures

7. **Troubleshooting Results**
   - Unexpected shifts? Check solvent matches experimental
   - Missing atoms in 3D viewer? Check SMILES validity
   - Large MAE values? Consider ensemble mode for flexible molecules

Add cross-references to science.md for methodology details.
  </action>
  <verify>
```bash
# Verify interpretation section exists
grep -E "## Result Interpretation" docs/usage.md

# Verify shift table and accuracy info
grep -E "(ppm|MAE|DELTA50)" docs/usage.md

# Verify ensemble explanation
grep -E "(Boltzmann|population-weighted)" docs/usage.md

# Total line count should exceed 400
wc -l docs/usage.md
```
  </verify>
  <done>
Result Interpretation section added with:
- Chemical shift table explanation (units, ranges, indices)
- Expected accuracy with MAE values
- Spectrum visualization guide
- 3D viewer usage instructions
- Ensemble results explanation
- Download recommendations
  </done>
</task>

<task type="auto">
  <name>Task 3: Commit API Reference and Result Interpretation</name>
  <files>docs/usage.md</files>
  <action>
Stage and commit the documentation additions:

```bash
git add docs/usage.md
git commit -m "docs(27): add REST API reference and result interpretation

- Document all API endpoints with curl examples (USAGE-02)
- Add complete workflow script for programmatic usage
- Explain chemical shift tables and expected accuracy
- Document spectrum visualizations and 3D viewer usage (USAGE-06)
- Explain ensemble results and Boltzmann averaging
- Add download recommendations and troubleshooting tips

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"
```
  </action>
  <verify>
```bash
# Verify commit created
git log -1 --oneline

# Verify total content
wc -l docs/usage.md
# Should exceed 400 lines

# Final verification of all sections
grep -E "^## " docs/usage.md
# Should show all major sections
```
  </verify>
  <done>
REST API Reference and Result Interpretation documentation committed, completing USAGE-02 and USAGE-06 requirements.
  </done>
</task>

</tasks>

<verification>
- [ ] REST API Reference section documents all endpoints
- [ ] Each endpoint has at least one curl example
- [ ] Complete workflow example (submit -> poll -> download) included
- [ ] Error handling with HTTP status codes documented
- [ ] Result Interpretation section explains shift tables
- [ ] Spectrum visualization guide included
- [ ] 3D viewer usage documented
- [ ] Ensemble results explanation with Boltzmann averaging
- [ ] Download recommendations provided
- [ ] Total docs/usage.md exceeds 400 lines
- [ ] Changes committed to git
</verification>

<success_criteria>
- USAGE-01 (complete): Web UI workflow now fully documented with result interpretation
- USAGE-02: REST API fully documented with curl examples for all endpoints
- USAGE-06: Result interpretation guide covers shifts, spectra, 3D viewer
</success_criteria>

<output>
After completion, create `.planning/phases/27-usage-guide/27-02-SUMMARY.md`
</output>
