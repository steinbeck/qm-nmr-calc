---
phase: 27-usage-guide
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/usage.md
autonomous: true

must_haves:
  truths:
    - "User can learn web UI workflow by reading documentation"
    - "User understands single-conformer vs ensemble mode decision"
    - "User knows when to select each solvent option"
    - "User understands draft vs production preset tradeoffs"
  artifacts:
    - path: "docs/usage.md"
      provides: "Web UI workflow and concepts documentation"
      contains: "## Web UI Workflow"
      min_lines: 200
  key_links:
    - from: "docs/usage.md"
      to: "docs/installation.md"
      via: "Cross-reference to installation"
      pattern: "installation.md"
---

<objective>
Document the web UI workflow and core calculation concepts (modes, solvents, presets) for the QM NMR Calculator.

Purpose: Enable users to understand how to submit jobs via the web interface and make informed decisions about calculation settings.

Output: Updated docs/usage.md with Web UI Workflow section (submit, status, results pages), Calculation Modes section (single vs ensemble), Solvent Selection section (CHCl3, DMSO, gas phase), and Presets section (draft vs production).
</objective>

<execution_context>
@/home/chris/.claude/get-shit-done/workflows/execute-plan.md
@/home/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/26-installation-guide/26-01-SUMMARY.md

# Source files for accurate documentation
@src/qm_nmr_calc/api/templates/submit.html
@src/qm_nmr_calc/api/templates/status.html
@src/qm_nmr_calc/api/templates/results.html
@src/qm_nmr_calc/solvents.py
@src/qm_nmr_calc/presets.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Web UI Workflow and Calculation Settings Documentation</name>
  <files>docs/usage.md</files>
  <action>
Replace the placeholder content in docs/usage.md with comprehensive user documentation covering:

1. **Introduction** (~20 lines)
   - Brief intro stating this covers web UI and REST API usage
   - Target audience statement
   - Link to installation guide as prerequisite

2. **Web UI Workflow** (~80 lines)
   - **Submit Page** (`/`):
     - SMILES input with live preview (SmilesDrawer)
     - MOL/SDF file upload alternative
     - Solvent selection (required)
     - Preset selection (draft/production)
     - Conformer mode selection (ensemble recommended, single for speed)
     - Conformer method (RDKit KDG vs CREST when available)
     - Optional: molecule name, email notification
   - **Status Page** (`/status/{job_id}`):
     - Job details panel (ID, elapsed time, SMILES, settings)
     - 3D molecule preview (RDKit geometry during calculation)
     - Step progress tracker (what steps appear for single vs ensemble)
     - Conformer progress (ensemble only - shows X/N conformers)
     - Auto-refresh behavior and redirect on completion
   - **Results Page** (`/results/{job_id}`):
     - Interactive 3D viewer with shift labels (1H blue, 13C orange)
     - Conformer selector dropdown (ensemble only)
     - 1H and 13C spectrum images (click to enlarge)
     - Ensemble metadata panel (conformer count, energy range, top populations)
     - Shift tables (1H and 13C with atom indices)
     - Download section (XYZ, SDF, ZIP, PNG spectra, structure PNG)

3. **Calculation Modes** (~50 lines) - USAGE-03
   - **Single Conformer Mode**:
     - Fastest option, uses lowest-energy RDKit conformer
     - Best for rigid molecules (few rotatable bonds)
     - Good for quick screening or when conformational flexibility is minimal
   - **Ensemble Mode** (recommended):
     - Generates multiple conformers
     - DFT optimizes each conformer
     - Boltzmann-weighted averaging of shifts
     - More accurate for flexible molecules
     - Two methods:
       - RDKit KDG: Fast, always available, good for most molecules
       - CREST: More thorough, requires CREST/xTB installation
   - Include decision flowchart or guidance table

4. **Solvent Selection** (~40 lines) - USAGE-04
   - Available solvents: chloroform (chcl3), DMSO (dmso), gas phase (vacuum)
   - Explain COSMO solvation model (conductor-like screening)
   - When to use each:
     - CHCl3: Most common NMR solvent, match experimental conditions
     - DMSO: Polar protic molecules, biomolecules
     - Gas phase: Reference calculations, gas-phase experiments
   - Note: Solvent affects both geometry optimization and NMR calculation

5. **Calculation Presets** (~40 lines) - USAGE-05
   - **Draft preset**:
     - Basis set: 6-31G*
     - Faster (~5-10 min for small molecules)
     - Lower accuracy (MAE ~0.5-1.0 ppm for 1H)
     - Use for: Quick screening, testing, validating SMILES
   - **Production preset**:
     - Basis set: 6-311+G(2d,p)
     - Slower (~30-60 min for small molecules)
     - Higher accuracy (MAE ~0.2-0.3 ppm for 1H)
     - Use for: Publication, structure verification, final results
   - Both use B3LYP functional with GIAO method

Use markdown formatting consistent with installation.md:
- Clear headings and subheadings
- Code blocks for commands and examples
- Tables for comparisons
- > Note: blocks for important callouts
- Cross-references to related docs
  </action>
  <verify>
Verify documentation completeness:
```bash
# Check file exists and has substantial content
wc -l docs/usage.md
# Should be at least 200 lines

# Verify key sections exist
grep -E "## (Web UI Workflow|Calculation Modes|Solvent Selection|Calculation Presets)" docs/usage.md
# Should match all 4 section headings

# Verify cross-references
grep -E "installation.md|architecture.md|science.md" docs/usage.md
# Should find cross-references to related docs
```
  </verify>
  <done>
docs/usage.md contains:
- Web UI Workflow section describing submit, status, and results pages
- Calculation Modes section explaining single vs ensemble with decision guidance
- Solvent Selection section with CHCl3, DMSO, gas phase and when to use each
- Calculation Presets section explaining draft vs production tradeoffs
  </done>
</task>

<task type="auto">
  <name>Task 2: Commit Web UI and Concepts Documentation</name>
  <files>docs/usage.md</files>
  <action>
Stage and commit the documentation changes:

```bash
git add docs/usage.md
git commit -m "docs(27): add web UI workflow and calculation concepts

- Document submit/status/results page workflows
- Explain single vs ensemble conformer modes (USAGE-03)
- Document solvent selection and COSMO model (USAGE-04)
- Explain draft vs production preset tradeoffs (USAGE-05)
- Add decision guidance for mode/solvent/preset selection

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"
```
  </action>
  <verify>
```bash
# Verify commit was created
git log -1 --oneline
# Should show the documentation commit

# Verify file is tracked
git status
# Should show clean working tree
```
  </verify>
  <done>
Documentation changes committed with descriptive message referencing USAGE-03, USAGE-04, and USAGE-05 requirements.
  </done>
</task>

</tasks>

<verification>
- [ ] docs/usage.md exists with at least 200 lines of content
- [ ] Web UI Workflow section covers submit, status, and results pages
- [ ] Calculation Modes section explains single vs ensemble decision
- [ ] Solvent Selection section covers all three solvents with guidance
- [ ] Calculation Presets section explains draft vs production
- [ ] Cross-references to installation.md and other docs included
- [ ] Content matches actual UI behavior (verified against templates)
- [ ] Changes committed to git
</verification>

<success_criteria>
- USAGE-01 (partial): Web UI workflow documented with page descriptions
- USAGE-03: Single vs ensemble mode selection explained
- USAGE-04: Solvent selection and implications documented
- USAGE-05: Preset differences (draft vs production) explained
</success_criteria>

<output>
After completion, create `.planning/phases/27-usage-guide/27-01-SUMMARY.md`
</output>
