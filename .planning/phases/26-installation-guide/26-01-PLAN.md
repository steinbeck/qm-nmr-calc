---
phase: 26-installation-guide
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/installation.md
autonomous: true

must_haves:
  truths:
    - "New user can install all required system dependencies following documentation"
    - "New user can set up uv and Python environment"
    - "New user can optionally configure CREST/xTB for ensemble mode"
    - "New user can validate their environment works correctly"
    - "New user can troubleshoot common installation problems"
  artifacts:
    - path: "docs/installation.md"
      provides: "Comprehensive installation guide"
      min_lines: 200
      contains:
        - "NWChem"
        - "uv sync"
        - "CREST"
        - "xTB"
        - "Troubleshooting"
  key_links:
    - from: "docs/installation.md"
      to: "README.md#quick-start"
      via: "reference link"
      pattern: "README.*quick.start|Quick Start"
---

<objective>
Create comprehensive installation documentation covering all system dependencies, Python setup, optional conformer tools, environment validation, and troubleshooting.

Purpose: Enable new users (academic researchers and developers) to set up the QM NMR Calculator from scratch with minimal friction. Current placeholder docs/installation.md will be replaced with production-ready documentation.

Output: Complete `docs/installation.md` covering INSTALL-01 through INSTALL-05 requirements.
</objective>

<execution_context>
@/home/chris/.claude/get-shit-done/workflows/execute-plan.md
@/home/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-readme-and-docs-structure/25-01-SUMMARY.md

# Source files with dependency/installation info
@pyproject.toml
@README.md
@docs/installation.md

# Source code showing external tool detection patterns
@src/qm_nmr_calc/conformers/crest_generator.py
@src/qm_nmr_calc/conformers/xtb_ranking.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Core Installation Documentation</name>
  <files>docs/installation.md</files>
  <action>
Replace the placeholder docs/installation.md with comprehensive installation documentation covering:

**Structure:**
1. **Prerequisites Overview** - Quick list of what's needed (system, Python, optional)

2. **System Dependencies** (INSTALL-01)
   - NWChem 7.0.2+ installation:
     - Ubuntu/Debian: `sudo apt install nwchem`
     - Fedora: `sudo dnf install nwchem`
     - From source: link to https://nwchemgit.github.io/
     - Version check: `nwchem --version` or similar
   - OpenMPI (for NWChem parallel execution):
     - Ubuntu: `sudo apt install openmpi-bin libopenmpi-dev`
     - Purpose: enables multi-core DFT calculations
   - Python 3.11+ requirement:
     - Ubuntu: `sudo apt install python3.11 python3.11-venv`
     - Check version: `python3 --version`

3. **Project Setup with uv** (INSTALL-02)
   - What is uv: fast Python package manager from Astral
   - Installation: `curl -LsSf https://astral.sh/uv/install.sh | sh`
   - Alternative: `pip install uv`
   - Clone and install:
     ```bash
     git clone https://github.com/steinbeck/qm-nmr-calc.git
     cd qm-nmr-calc
     uv sync
     ```
   - What uv sync does: creates .venv, installs all dependencies from pyproject.toml

**Writing style:**
- Clear section headings with markdown anchors
- Command blocks with copy-paste ready commands
- Brief explanations of WHY each dependency matters
- Use admonitions (> **Note:** or > **Warning:**) for important callouts
- Target audience: chemists comfortable with command line basics

**Do NOT include yet:**
- CREST/xTB setup (Task 2)
- Environment validation (Task 2)
- Troubleshooting (Task 2)
  </action>
  <verify>
- docs/installation.md exists and is >100 lines
- Contains NWChem installation instructions for at least 2 distros
- Contains OpenMPI installation instructions
- Contains Python 3.11+ requirement and version check command
- Contains uv installation and `uv sync` instructions
- grep confirms "NWChem" and "uv sync" and "OpenMPI" present
  </verify>
  <done>
Core installation documentation covers system dependencies (NWChem, MPI, Python) and project setup with uv package manager. Requirements INSTALL-01 and INSTALL-02 satisfied.
  </done>
</task>

<task type="auto">
  <name>Task 2: Optional Tools, Validation, and Troubleshooting</name>
  <files>docs/installation.md</files>
  <action>
Append to the existing docs/installation.md the remaining sections:

4. **Optional: CREST and xTB Setup** (INSTALL-03)
   - Purpose: High-accuracy conformer generation for ensemble mode
   - Note: App works fully without these (uses RDKit KDG instead)
   - Installation via conda:
     ```bash
     conda install -c conda-forge crest xtb
     ```
   - Alternative: download binaries from:
     - CREST: https://github.com/crest-lab/crest
     - xTB: https://github.com/grimme-lab/xtb
   - Add to PATH if installed manually
   - Verify installation:
     ```bash
     which crest && crest --version
     which xtb && xtb --version
     ```
   - Reference the detect_crest_available() pattern from code: both binaries must be on PATH
   - GFN2-xTB used for conformer ranking and CREST ensemble generation

5. **Environment Validation** (INSTALL-04)
   - Step-by-step validation checklist:
     ```bash
     # Check Python version
     python3 --version  # Should show 3.11+

     # Check NWChem
     which nwchem  # Should return a path

     # Check the app starts
     uv run python scripts/run_api.py &
     curl http://localhost:8000/api/v1/health
     # Kill with Ctrl+C or kill %1

     # Optional: Check CREST/xTB
     which crest xtb  # Both paths if installed
     ```
   - Expected health endpoint response includes crest_available field
   - Link to Usage Guide for running first calculation

6. **Troubleshooting Common Issues** (INSTALL-05)
   Create a troubleshooting section with common problems:

   **NWChem not found:**
   - Symptom: `FileNotFoundError: nwchem` or job fails at DFT step
   - Fix: Ensure NWChem is installed and on PATH
   - Check: `which nwchem`

   **RDKit import errors:**
   - Symptom: `ModuleNotFoundError: rdkit`
   - Fix: Ensure using the project venv: `source .venv/bin/activate` or use `uv run`

   **MPI/OpenMPI issues:**
   - Symptom: NWChem hangs or fails with MPI errors
   - Fix: Install OpenMPI (`sudo apt install openmpi-bin`)
   - Note: Single-core works without MPI but is slower

   **Permission denied on scratch:**
   - Symptom: Job fails with permission errors
   - Fix: Ensure JOBS_DIR (default: ./jobs) is writable

   **CREST timeout on large molecules:**
   - Symptom: CREST ensemble generation times out (>2h default)
   - Fix: Consider using RDKit mode for very flexible molecules
   - Note: Default timeout is 7200s (2 hours)

   **Memory issues:**
   - Minimum: 4GB RAM for small molecules
   - Recommended: 8GB+ for production presets
   - DFT calculations are memory-intensive

7. **Getting Help**
   - Link to GitHub issues
   - Mention the /api/v1/health endpoint for diagnostics

**Writing style:**
- Continue the clear markdown structure from Task 1
- Use code blocks for all commands
- Troubleshooting as problem/symptom/fix format
- Keep explanations concise but complete
  </action>
  <verify>
- docs/installation.md is now >200 lines total
- Contains CREST section with conda and manual install options
- Contains xTB section referencing xtb binary check
- Contains validation section with health endpoint check
- Contains Troubleshooting section with at least 5 common issues
- grep confirms "CREST" and "xTB" and "Troubleshooting" present
  </verify>
  <done>
Complete installation guide with optional CREST/xTB setup, environment validation steps, and troubleshooting section. Requirements INSTALL-03, INSTALL-04, and INSTALL-05 satisfied.
  </done>
</task>

</tasks>

<verification>
After completing both tasks, verify:

1. **Completeness check:**
   ```bash
   wc -l docs/installation.md  # Should be >200 lines
   ```

2. **All requirements covered:**
   ```bash
   grep -c "NWChem" docs/installation.md      # INSTALL-01
   grep -c "uv sync" docs/installation.md     # INSTALL-02
   grep -c "CREST" docs/installation.md       # INSTALL-03
   grep -c "xtb" docs/installation.md         # INSTALL-03
   grep -c "health" docs/installation.md      # INSTALL-04
   grep -c "Troubleshooting" docs/installation.md  # INSTALL-05
   ```

3. **Markdown structure valid:**
   - Check heading hierarchy (# > ## > ###)
   - No broken internal links

4. **Cross-reference to README:**
   - Verify link to Quick Start section exists or reference to README.md
</verification>

<success_criteria>
Phase 26 is complete when:
- docs/installation.md contains comprehensive installation guide (>200 lines)
- System dependencies (NWChem, OpenMPI, Python) documented with version requirements
- uv package manager installation and project setup explained
- Optional CREST/xTB configuration documented with both conda and manual options
- Environment validation steps included with health endpoint check
- Troubleshooting section covers at least 5 common issues
- All INSTALL-01 through INSTALL-05 requirements satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/26-installation-guide/26-01-SUMMARY.md`
</output>
