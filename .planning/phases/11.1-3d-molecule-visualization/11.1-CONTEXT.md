# Phase 11.1: 3D Molecule Visualization - Context

**Gathered:** 2026-01-24
**Status:** Ready for planning

<domain>
## Phase Boundary

Add interactive 3D molecule visualization to job status and results pages using 3Dmol.js. Port the implementation from the DELTA50 benchmark viewer (Phase 8.1). Show calculated chemical shifts annotated on atoms. Display RDKit-generated geometry during calculation, auto-refresh to optimized NWChem geometry when complete.

</domain>

<decisions>
## Implementation Decisions

### Placement & Layout
- Add 3D viewer alongside existing visualizations (spectrum plot, 2D structure), not replacing them
- Equal prominence with spectrum plot — both are primary visuals
- Show 3D viewer on status page while calculation is running (with RDKit geometry)
- Auto-refresh to optimized geometry when calculation completes (page already polls for status)

### Shift Annotations
- Always-visible floating labels near each H/C atom (like DELTA50 viewer)
- Color-coded labels to distinguish 1H vs 13C shifts (e.g., blue for 1H, orange for 13C)
- No labels until calculation completes — show structure only during "running" status
- 2 decimal places for shift values (e.g., 7.26 ppm)

### Viewer Controls
- Use same rendering style as DELTA50 viewer (port existing implementation)
- No style toggle needed — single style sufficient
- Static by default — molecule doesn't rotate until user interacts
- Responsive sizing — adapts to container/screen size

### Data Source
- Store RDKit-generated XYZ in job directory at submission time for easy retrieval
- For file uploads (MOL/SDF): use uploaded geometry if 3D coords present
- For SMILES submissions: generate 3D coords with RDKit (ETKDGv3, deterministic seed)
- Optimized geometry comes from NWChem output (already parsed and stored)

### Claude's Discretion
- API design for serving geometry data (new endpoint vs embed in status)
- Exact label positioning and offset from atoms
- 3Dmol.js viewer initialization parameters
- Error handling if geometry data unavailable

</decisions>

<specifics>
## Specific Ideas

- Port implementation from Phase 8.1 DELTA50 viewer — patterns already established
- Show RDKit geometry immediately on job submission, swap to NWChem optimized when ready
- Leverage existing status page polling to trigger geometry refresh

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 11.1-3d-molecule-visualization*
*Context gathered: 2026-01-24*
