---
phase: 10-scaling-factors
task: 0
total_tasks: 6
status: planned
last_updated: 2026-01-23T10:45:00Z
---

<current_state>
Phase 10 planning is complete. Two PLAN.md files created and verified. Ready to execute.

No code has been written yet - this phase is at the "planned, not started" stage.
</current_state>

<completed_work>

- Context gathering (/gsd:discuss-phase 10): Captured decisions on regression approach, factor organization, validation metrics, output format
- Research (10-RESEARCH.md): Investigated statsmodels OLS, scipy bootstrap, data aggregation patterns
- Planning (10-01-PLAN.md, 10-02-PLAN.md): Created 2 plans in 2 waves with 6 total tasks
- Verification: Plan checker approved with note that CHESHIRE comparison not applicable (Gaussian vs NWChem)

</completed_work>

<remaining_work>

**Plan 01 (Wave 1) - Analysis Module:**
- Task 1: Add ScalingFactor model to benchmark/models.py
- Task 2: Create analysis.py with data aggregation and regression
- Task 3: Test factor derivation end-to-end

**Plan 02 (Wave 2) - Report Generation:**
- Task 1: Add plot generation functions to analysis.py
- Task 2: Add generate_report function and per-compound statistics
- Task 3: Add CLI analyze command and generate final report

</remaining_work>

<decisions_made>

- Regression approach: Simple linear (shift = slope × shielding + intercept), residual-based outlier removal (>3 std dev)
- Factor organization: Key by (functional, basis_set, nucleus, solvent), include metadata (R², MAE, RMSD, n_points, CIs)
- Validation: In-sample DELTA50 validation; external nmrshiftdb validation noted as future work
- CHESHIRE comparison: Not applicable - CHESHIRE factors are Gaussian-derived, can't compare directly to NWChem factors
- WP04: Deferred - Phase 9 only ran B3LYP, so only B3LYP factors can be derived
- Storage: Python constants + JSON export (Claude's discretion)
- Publication data: Per-compound stats, confidence intervals, bootstrap uncertainty for paper

</decisions_made>

<blockers>
None - ready to execute
</blockers>

<context>
This phase derives NMR scaling factors from the 100 B3LYP benchmark calculations completed in Phase 9. The factors will convert calculated shielding values to predicted chemical shifts with better accuracy than simple TMS referencing.

Key files to use:
- Experimental data: data/benchmark/delta50/experimental_shifts.json (has h1_assignments, c13_assignments)
- Calculated data: data/benchmark/results/compound_XX/B3LYP_{solvent}/shifts.json (100 files)
- Existing modules: src/qm_nmr_calc/benchmark/data_loader.py, models.py, runner.py

The approach:
1. Aggregate shielding-shift pairs using atom index mapping
2. Fit OLS regression per nucleus/solvent combination
3. Remove outliers >3 std dev, refit
4. Generate SCALING-FACTORS.md report with tables and plots
5. Export factors for production use in Phase 11
</context>

<next_action>
Run: /gsd:execute-phase 10

This will execute both plans sequentially (Wave 1, then Wave 2), creating the analysis module, deriving 4 B3LYP scaling factor sets, and generating the publication-quality report.
</next_action>
