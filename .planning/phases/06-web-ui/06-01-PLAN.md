---
phase: 06-web-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/qm_nmr_calc/api/app.py
  - src/qm_nmr_calc/api/routers/web.py
  - src/qm_nmr_calc/api/routers/__init__.py
  - src/qm_nmr_calc/api/templates/base.html
  - src/qm_nmr_calc/api/static/css/custom.css
autonomous: true

must_haves:
  truths:
    - "Browser can load home page at / with styled HTML"
    - "Static CSS file is served at /static/css/custom.css"
    - "Base template provides consistent header/footer for all pages"
  artifacts:
    - path: "src/qm_nmr_calc/api/app.py"
      provides: "StaticFiles mount, Jinja2Templates setup, web router inclusion"
      contains: "Jinja2Templates"
    - path: "src/qm_nmr_calc/api/routers/web.py"
      provides: "Web UI router with home route"
      exports: ["router"]
    - path: "src/qm_nmr_calc/api/templates/base.html"
      provides: "Base layout template with Pico CSS"
      contains: "pico.blue.min.css"
    - path: "src/qm_nmr_calc/api/static/css/custom.css"
      provides: "Custom styles for form and layout adjustments"
  key_links:
    - from: "src/qm_nmr_calc/api/app.py"
      to: "src/qm_nmr_calc/api/routers/web.py"
      via: "app.include_router(web.router)"
      pattern: "include_router.*web"
    - from: "src/qm_nmr_calc/api/app.py"
      to: "templates directory"
      via: "Jinja2Templates directory parameter"
      pattern: "Jinja2Templates.*templates"
---

<objective>
Set up Jinja2 template infrastructure and create the base layout template for the web UI.

Purpose: Establish the foundation that all web pages will build upon - app configuration, template engine setup, static file serving, and the base HTML template with Pico CSS blue theme.
Output: Working home page at / with styled header, footer, and Pico CSS loaded via CDN.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-web-ui/06-CONTEXT.md
@.planning/phases/06-web-ui/06-RESEARCH.md
@src/qm_nmr_calc/api/app.py
@src/qm_nmr_calc/api/routers/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create template and static directory structure</name>
  <files>
    src/qm_nmr_calc/api/templates/base.html
    src/qm_nmr_calc/api/static/css/custom.css
  </files>
  <action>
Create the directory structure and files:
1. Create `src/qm_nmr_calc/api/templates/` directory
2. Create `src/qm_nmr_calc/api/static/css/` directory

Create `base.html` with:
- DOCTYPE html, lang="en", data-theme="light"
- Meta viewport and color-scheme
- Pico CSS blue theme via CDN: `https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.blue.min.css`
- Link to custom.css using `url_for('static', path='/css/custom.css')`
- Title block: `{% block title %}QM NMR Calculator{% endblock %}`
- Header with nav: app name "QM NMR Calculator" as strong text, link to "/"
- Main element with container class and `{% block content %}{% endblock %}`
- Footer with small text: "Powered by ISiCLE and NWChem"
- Scripts block: `{% block scripts %}{% endblock %}`

Create `custom.css` with minimal styles:
- Set article max-width to 800px for better readability
- Center articles with margin: 0 auto
- Image cursor pointer for clickable images
- Modal image max-height: 80vh
- Any other minor adjustments for clean appearance
  </action>
  <verify>Files exist: `ls -la src/qm_nmr_calc/api/templates/ src/qm_nmr_calc/api/static/css/`</verify>
  <done>Template directory with base.html and static directory with custom.css exist</done>
</task>

<task type="auto">
  <name>Task 2: Create web router with home route</name>
  <files>
    src/qm_nmr_calc/api/routers/web.py
    src/qm_nmr_calc/api/routers/__init__.py
  </files>
  <action>
Create `web.py` router:
1. Import Request from fastapi, HTMLResponse from fastapi.responses
2. Import Jinja2Templates from fastapi.templating
3. Import Path from pathlib
4. Create templates instance: `templates = Jinja2Templates(directory=Path(__file__).resolve().parent.parent / "templates")`
5. Create router with `tags=["web"]` (no prefix - routes at root)

Add home route `GET /`:
- response_class=HTMLResponse
- Returns TemplateResponse for "submit.html" (will be created in Plan 02)
- For now, create a placeholder template that shows the form will go here
- Context should include: solvents list (from get_supported_solvents()), presets list

Create a placeholder `submit.html` template that extends base.html and shows "Form coming soon" - this will be replaced in Plan 02 but allows testing the infrastructure.

Update `__init__.py` to export web router.
  </action>
  <verify>`python -c "from qm_nmr_calc.api.routers import web; print(web.router)"`</verify>
  <done>web.py router imports successfully with home route defined</done>
</task>

<task type="auto">
  <name>Task 3: Integrate templates and web router into app</name>
  <files>src/qm_nmr_calc/api/app.py</files>
  <action>
Modify app.py:
1. Add imports: StaticFiles from fastapi.staticfiles, Path from pathlib
2. Import web router from .routers
3. After app = FastAPI(...), add:
   - BASE_DIR = Path(__file__).resolve().parent
   - Mount static files: `app.mount("/static", StaticFiles(directory=BASE_DIR / "static"), name="static")`
4. Include web router (no prefix): `app.include_router(web.router)`

Order of includes:
- health router (existing, no prefix)
- web router (new, no prefix)
- jobs router (existing, /api/v1 prefix)

Note: Static mount must come before router includes to avoid route conflicts.
  </action>
  <verify>
Run: `cd /home/christoph_steinbeck_gmail_com/develop/qm-nmr-calc && python -c "from qm_nmr_calc.api.app import app; print([r.path for r in app.routes])"`
Should show / route, /static path, and /api/v1 routes.
  </verify>
  <done>App serves home page at / with Pico CSS styling and static files at /static/</done>
</task>

</tasks>

<verification>
1. Start dev server: `cd /home/christoph_steinbeck_gmail_com/develop/qm-nmr-calc && uvicorn qm_nmr_calc.api.app:app --reload --port 8000`
2. Verify home page: `curl -s http://localhost:8000/ | head -20` - should show HTML with Pico CSS link
3. Verify static CSS: `curl -s http://localhost:8000/static/css/custom.css` - should return CSS content
4. Verify API still works: `curl -s http://localhost:8000/health` - should return health status
</verification>

<success_criteria>
- GET / returns HTML page with Pico CSS blue theme loaded
- GET /static/css/custom.css returns CSS file
- Existing API endpoints (/health, /api/v1/jobs) still functional
- Page displays header "QM NMR Calculator" and footer "Powered by ISiCLE and NWChem"
</success_criteria>

<output>
After completion, create `.planning/phases/06-web-ui/06-01-SUMMARY.md`
</output>
