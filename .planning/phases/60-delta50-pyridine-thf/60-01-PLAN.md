---
phase: 60-delta50-pyridine-thf
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - data/benchmark/results/compound_*/B3LYP_Pyridine/shifts.json
  - data/benchmark/results/compound_*/B3LYP_THF/shifts.json
  - data/benchmark/results/status.json
  - .planning/phases/60-delta50-pyridine-thf/BENCHMARK-RESULTS-PT.md
autonomous: false

must_haves:
  truths:
    - "Pilot run (5 molecules x 2 solvents = 10 calculations) completes for Pyridine and THF"
    - "Full headless run dispatched for remaining Pyridine and THF calculations"
    - "All 50 Pyridine benchmark calculations produce shifts.json with shielding_data"
    - "All 50 THF benchmark calculations produce shifts.json with shielding_data"
    - "No systematic COSMO convergence errors in either solvent"
  artifacts:
    - path: "data/benchmark/results/compound_01/B3LYP_Pyridine/shifts.json"
      provides: "Sample completed Pyridine benchmark result"
      contains: "shielding_data"
    - path: "data/benchmark/results/compound_01/B3LYP_THF/shifts.json"
      provides: "Sample completed THF benchmark result"
      contains: "shielding_data"
    - path: ".planning/phases/60-delta50-pyridine-thf/BENCHMARK-RESULTS-PT.md"
      provides: "Execution summary for Pyridine and THF benchmarks"
      min_lines: 20
  key_links:
    - from: "data/benchmark/results/compound_*/B3LYP_Pyridine/shifts.json"
      to: "data/benchmark/delta50/experimental_shifts.json"
      via: "molecule_id correspondence"
      pattern: "compound_\\d+"
    - from: "data/benchmark/results/compound_*/B3LYP_THF/shifts.json"
      to: "data/benchmark/delta50/experimental_shifts.json"
      via: "molecule_id correspondence"
      pattern: "compound_\\d+"
---

<objective>
Run DELTA50 benchmark calculations for Pyridine and THF solvents (50 molecules x 2 solvents = 100 NWChem calculations)

Purpose: Generate calculated NMR shielding tensors for all 50 DELTA50 molecules in Pyridine and THF solvents using B3LYP functional, which will be used in Phase 63 to derive solvent-specific scaling factors.
Output: 100 shifts.json files (50 Pyridine + 50 THF), status tracking, and execution summary report.
</objective>

<execution_context>
@/home/chris/.claude/get-shit-done/workflows/execute-plan.md
@/home/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/59-benchmark-infrastructure/59-01-SUMMARY.md
@src/qm_nmr_calc/benchmark/runner.py
@src/qm_nmr_calc/benchmark/__main__.py
@src/qm_nmr_calc/nwchem/input_gen.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Execute pilot run for Pyridine and THF (5 molecules, 10 calculations)</name>
  <files>data/benchmark/results/</files>
  <action>
Run a pilot benchmark with the first 5 molecules for Pyridine and THF solvents to validate the COSMO solvation pipeline before committing to the full run.

1. **Execute pilot with first 5 molecules:**
   ```bash
   .venv/bin/python -m qm_nmr_calc.benchmark run \
     --molecules compound_01 compound_02 compound_03 compound_04 compound_05 \
     --solvents Pyridine THF \
     --functionals B3LYP \
     --processes 4
   ```

2. **Verify pilot results:**
   - Check status: `.venv/bin/python -m qm_nmr_calc.benchmark status`
   - Expect: 10 new calculations completed (5 molecules x 2 solvents)
   - Verify shifts.json files exist:
     ```bash
     ls data/benchmark/results/compound_01/B3LYP_Pyridine/shifts.json
     ls data/benchmark/results/compound_01/B3LYP_THF/shifts.json
     ```

3. **Validate shielding data looks reasonable:**
   - Read a sample shifts.json and check:
     - `shielding_data` key exists and contains atom entries
     - Shielding values are in physically reasonable ranges (H: ~25-35 ppm, C: ~0-200 ppm raw shielding)
   - Note: `h1_shifts` and `c13_shifts` will be empty arrays (no scaling factors yet for these solvents). This is expected. The `shielding_data` is what matters for Phase 63.

4. **If pilot has failures:**
   - Check error messages in the CLI output
   - If >2 failures out of 10: STOP and investigate (likely a COSMO convergence issue)
   - If <=2 failures: document them and proceed (some molecules may need special handling)
   - Common failures: COSMO convergence errors, SCF non-convergence (usually molecule-specific)

This is an interactive pilot run. Do NOT use --headless.
  </action>
  <verify>
- `ls data/benchmark/results/compound_01/B3LYP_Pyridine/shifts.json` exists
- `ls data/benchmark/results/compound_01/B3LYP_THF/shifts.json` exists
- At least 8 out of 10 pilot calculations completed successfully
- Sample shifts.json contains `shielding_data` with atom entries
  </verify>
  <done>
- Pilot run executed (5 molecules x 2 solvents = 10 calculations attempted)
- Pyridine and THF COSMO solvation confirmed working
- Shielding data validated in expected ranges
- Any failures documented
- Ready to proceed with full run
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Pilot run completed: 5 DELTA50 molecules x Pyridine + THF solvents (10 calculations)</what-built>
  <how-to-verify>
1. Check pilot results:
   ```bash
   .venv/bin/python -m qm_nmr_calc.benchmark status
   ```

2. Verify sample output looks reasonable:
   ```bash
   .venv/bin/python -c "
   import json
   for solvent in ['Pyridine', 'THF']:
       with open(f'data/benchmark/results/compound_01/B3LYP_{solvent}/shifts.json') as f:
           d = json.load(f)
       atoms = d.get('shielding_data', [])
       h_count = len([a for a in atoms if a.get('element') == 'H' or a.get('atom') == 'H'])
       c_count = len([a for a in atoms if a.get('element') == 'C' or a.get('atom') == 'C'])
       print(f'{solvent} - H atoms: {h_count}, C atoms: {c_count}')
   "
   ```

3. Confirm ready to proceed with full headless run (remaining 45 molecules, will take ~8-10 hours)
  </how-to-verify>
  <resume-signal>Type "proceed" to continue with full headless run, or describe any issues found</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Launch full headless run for remaining Pyridine and THF calculations</name>
  <files>data/benchmark/results/</files>
  <action>
Launch the full benchmark run in headless mode. Resume support (default behavior) will skip the 10 pilot calculations already completed.

1. **Clear any existing STOP file:**
   ```bash
   rm -f data/benchmark/results/STOP
   ```

2. **Launch headless benchmark for Pyridine and THF:**
   ```bash
   nohup .venv/bin/python -m qm_nmr_calc.benchmark run \
     --solvents Pyridine THF \
     --functionals B3LYP \
     --headless \
     > /dev/null 2>&1 &
   echo "Benchmark PID: $!"
   ```

3. **Verify it started:**
   ```bash
   sleep 10
   .venv/bin/python -m qm_nmr_calc.benchmark status
   ```
   Should show state: "running" with progress incrementing past the pilot results.

4. **Provide monitoring instructions to user:**
   - Check progress: `.venv/bin/python -m qm_nmr_calc.benchmark status`
   - View log: `tail -f data/benchmark/results/benchmark.log`
   - Stop gracefully: `.venv/bin/python -m qm_nmr_calc.benchmark stop`

5. **Estimate completion time:**
   - Based on pilot timing, calculate: (avg time per calc) x 90 remaining / 3600 = estimated hours
   - Expected: ~8-10 hours (90 remaining calculations x ~400s average)
   - Document this estimate for the user

The run continues independently. Resume support means it can be stopped and restarted across sessions.
  </action>
  <verify>
- `.venv/bin/python -m qm_nmr_calc.benchmark status` shows state: "running"
- completed count is increasing
- current_task shows a Pyridine or THF calculation
  </verify>
  <done>
- Full headless run launched for Pyridine and THF
- PID and monitoring instructions provided
- Estimated completion time documented
- Run will continue independently
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full Pyridine and THF benchmark dispatched (100 calculations total)</what-built>
  <how-to-verify>
The benchmark is running independently. Monitor with:

1. **Check progress anytime:**
   ```bash
   .venv/bin/python -m qm_nmr_calc.benchmark status
   ```

2. **When complete**, status will show `state: "complete"`. Verify all 100 results:
   ```bash
   find data/benchmark/results/compound_* -path "*/B3LYP_Pyridine/shifts.json" | wc -l
   find data/benchmark/results/compound_* -path "*/B3LYP_THF/shifts.json" | wc -l
   ```
   Both counts should be 50 (or 48+ for 95%+ success rate).

3. If benchmark paused due to failures: check `.venv/bin/python -m qm_nmr_calc.benchmark status` for failure details.

Type "complete" when the benchmark finishes, or describe current status.
  </how-to-verify>
  <resume-signal>Type "complete" when all 100 calculations finish, "paused" if stopped at failure threshold, or describe status</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Verify completion and generate BENCHMARK-RESULTS-PT.md summary</name>
  <files>.planning/phases/60-delta50-pyridine-thf/BENCHMARK-RESULTS-PT.md</files>
  <action>
Verify all Pyridine and THF calculations completed and create a summary report.

1. **Count completed results:**
   ```bash
   echo "Pyridine:"
   find data/benchmark/results/compound_* -path "*/B3LYP_Pyridine/shifts.json" | wc -l
   echo "THF:"
   find data/benchmark/results/compound_* -path "*/B3LYP_THF/shifts.json" | wc -l
   ```
   Both should report 50 (or 48+ for 95%+ success rate).

2. **Check for any failures:**
   - Read status.json for failure records
   - If any molecules failed, list them explicitly

3. **Spot-check a few results to confirm shielding data quality:**
   - Check compound_01, compound_25, compound_50 for both solvents
   - Verify each has `shielding_data` with H and C atom entries

4. **Create BENCHMARK-RESULTS-PT.md** in the phase directory with:

```markdown
# DELTA50 Benchmark Results: Pyridine & THF

**Execution Date:** {date}
**Solvents:** Pyridine, THF
**Functional:** B3LYP / 6-311+G(2d,p)
**Molecules:** 50 (DELTA50 set)

## Summary

| Solvent | Completed | Failed | Success Rate |
|---------|-----------|--------|-------------|
| Pyridine | X/50 | Y | Z% |
| THF | X/50 | Y | Z% |
| **Total** | **X/100** | **Y** | **Z%** |

## Timing

- Average calculation time: {avg_seconds}s
- Total runtime: {hours}h
- COSMO parameters: Pyridine (dielectric=12.978), THF (dielectric=7.4257)

## Failures (if any)

{List each failure: molecule_id, solvent, error message}

## Data Location

Results: `data/benchmark/results/compound_XX/B3LYP_{Pyridine|THF}/shifts.json`

Each shifts.json contains:
- `shielding_data`: Raw isotropic shielding tensors (used for scaling factor derivation)
- `h1_shifts` / `c13_shifts`: Empty (no scaling factors yet for these solvents)

## Next Steps

- Phase 61 runs Toluene and DCM benchmarks
- Phase 63 derives scaling factors from all 6 solvents' shielding data
```

5. **Confirm Phase 60 success criteria (from ROADMAP):**
   - All 50 Pyridine DELTA50 molecules calculate successfully with COSMO solvation (or 95%+)
   - All 50 THF DELTA50 molecules calculate successfully with COSMO solvation (or 95%+)
   - Calculated shielding data extracted and stored for both solvents
  </action>
  <verify>
- `find data/benchmark/results/compound_* -path "*/B3LYP_Pyridine/shifts.json" | wc -l` outputs 48+
- `find data/benchmark/results/compound_* -path "*/B3LYP_THF/shifts.json" | wc -l` outputs 48+
- BENCHMARK-RESULTS-PT.md exists in phase directory with completion statistics
  </verify>
  <done>
- 50 Pyridine calculations confirmed complete with shielding tensors (or 95%+ success rate)
- 50 THF calculations confirmed complete with shielding tensors (or 95%+ success rate)
- Summary report created documenting execution results and timing
- Requirements BENCH-02 (pyridine) and BENCH-03 (THF) satisfied
  </done>
</task>

</tasks>

<verification>
- [ ] Pilot run validated Pyridine and THF COSMO solvation works (5 molecules each)
- [ ] Full run completed for all 50 molecules in both Pyridine and THF
- [ ] 48+ shifts.json files exist under B3LYP_Pyridine directories (95%+ success rate)
- [ ] 48+ shifts.json files exist under B3LYP_THF directories (95%+ success rate)
- [ ] All shifts.json files contain shielding_data with H and C atom entries
- [ ] No systematic COSMO convergence errors (isolated failures acceptable)
- [ ] BENCHMARK-RESULTS-PT.md created with execution summary
</verification>

<success_criteria>
Pyridine and THF DELTA50 benchmarks complete:
- 50 Pyridine B3LYP calculations completed with shielding tensors (95%+ success rate)
- 50 THF B3LYP calculations completed with shielding tensors (95%+ success rate)
- Shielding data validated and ready for scaling factor derivation in Phase 63
- Requirements BENCH-02 and BENCH-03 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/60-delta50-pyridine-thf/60-01-SUMMARY.md`
</output>
