---
phase: 23-accessibility-testing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/qm_nmr_calc/api/static/css/tokens.css
  - src/qm_nmr_calc/api/static/css/base.css
autonomous: true

must_haves:
  truths:
    - "Keyboard users see visible focus indicators on all interactive elements"
    - "Focus indicators have sufficient contrast against backgrounds"
    - "Summary/details elements have visible focus when tabbed to"
  artifacts:
    - path: "src/qm_nmr_calc/api/static/css/tokens.css"
      provides: "Focus color token"
      contains: "--color-focus"
    - path: "src/qm_nmr_calc/api/static/css/base.css"
      provides: "Focus-visible rules for all interactive elements"
      contains: ":focus-visible"
  key_links:
    - from: "base.css :focus-visible rules"
      to: "tokens.css --color-focus"
      via: "var() reference"
      pattern: "var\\(--color-focus"
---

<objective>
Add comprehensive keyboard focus indicators using :focus-visible pseudo-class

Purpose: WCAG 2.4.7 (Focus Visible - Level A) requires visible focus indicators for keyboard navigation. Current implementation covers links and buttons but misses summary, details, and other interactive elements.

Output: Updated CSS with consistent focus-visible styling across all interactive elements
</objective>

<execution_context>
@/home/chris/.claude/get-shit-done/workflows/execute-plan.md
@/home/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/23-accessibility-testing/23-RESEARCH.md

# Key files to modify
@src/qm_nmr_calc/api/static/css/tokens.css
@src/qm_nmr_calc/api/static/css/base.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add focus token and comprehensive :focus-visible rules</name>
  <files>
    src/qm_nmr_calc/api/static/css/tokens.css
    src/qm_nmr_calc/api/static/css/base.css
  </files>
  <action>
1. In tokens.css, add focus color token near --color-primary:
   ```css
   /* Focus indicator color (matches primary for consistency) */
   --color-focus: var(--color-primary);
   --focus-ring-width: 2px;
   --focus-ring-offset: 2px;
   ```

2. In base.css, update the existing form focus styles to use :focus-visible instead of :focus:
   - Change `input:focus, select:focus, textarea:focus` to `input:focus-visible, select:focus-visible, textarea:focus-visible`
   - Keep the existing ring styling (box-shadow) but use --color-focus token

3. In base.css, add :focus-visible rules for additional interactive elements after the form section:
   ```css
   /* ===== Focus Indicators (Keyboard Navigation) ===== */
   /* Using :focus-visible for keyboard-only indicators (not mouse clicks) */

   summary:focus-visible {
       outline: var(--focus-ring-width) solid var(--color-focus);
       outline-offset: var(--focus-ring-offset);
       border-radius: 2px;
   }

   details:focus-within summary {
       /* Highlight summary when details content is focused */
       color: var(--color-primary);
   }
   ```

4. Ensure consistent styling pattern: 2px solid outline with 2px offset

Note: Links (a:focus-visible) and buttons (button:focus-visible) already have styles in base.css - verify they use --color-focus token or update them to use it.
  </action>
  <verify>
    1. Run `grep -n "focus-visible" src/qm_nmr_calc/api/static/css/base.css` - should show rules for a, button, input, select, textarea, summary
    2. Run `grep -n "color-focus" src/qm_nmr_calc/api/static/css/tokens.css` - should show token definition
    3. Start dev server and tab through elements to visually verify focus rings appear
  </verify>
  <done>
    - --color-focus and --focus-ring-* tokens defined in tokens.css
    - All interactive elements (links, buttons, inputs, selects, textareas, summary) have :focus-visible rules
    - Focus indicators use consistent 2px solid outline with 2px offset
    - Form inputs no longer show focus ring on mouse click (only keyboard)
  </done>
</task>

</tasks>

<verification>
1. Keyboard navigation test:
   - Open http://localhost:8000 in browser
   - Press Tab to navigate through interactive elements
   - Verify each element shows blue outline when focused
   - Verify clicking with mouse does NOT show focus ring (on buttons/links)

2. Code verification:
   - grep confirms :focus-visible rules for all interactive element types
   - No bare :focus rules remain (except where intentional for input fields)
</verification>

<success_criteria>
- All interactive elements (a, button, input, select, textarea, summary) have :focus-visible styling
- Focus indicators are 2px solid outline in primary color with 2px offset
- Form inputs show focus ring on both click and tab (forms need visual feedback)
- Buttons and links show focus ring only on keyboard navigation
</success_criteria>

<output>
After completion, create `.planning/phases/23-accessibility-testing/23-01-SUMMARY.md`
</output>
