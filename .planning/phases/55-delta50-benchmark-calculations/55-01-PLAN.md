---
phase: 55-delta50-benchmark-calculations
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - data/benchmark/results/compound_*/B3LYP_Methanol/shifts.json
  - data/benchmark/results/compound_*/B3LYP_Water/shifts.json
  - data/benchmark/results/status.json
  - .planning/phases/55-delta50-benchmark-calculations/BENCHMARK-RESULTS-MW.md
autonomous: false

must_haves:
  truths:
    - "Pilot run (5 molecules x 2 solvents = 10 calculations) completes for Methanol and Water"
    - "Full headless run dispatched for remaining Methanol and Water calculations"
    - "All 50 Methanol benchmark calculations produce shifts.json with shielding_data"
    - "All 50 Water benchmark calculations produce shifts.json with shielding_data"
    - "No COSMO convergence errors in either solvent"
  artifacts:
    - path: "data/benchmark/results/compound_01/B3LYP_Methanol/shifts.json"
      provides: "Sample completed Methanol benchmark result"
      contains: "shielding_data"
    - path: "data/benchmark/results/compound_01/B3LYP_Water/shifts.json"
      provides: "Sample completed Water benchmark result"
      contains: "shielding_data"
    - path: ".planning/phases/55-delta50-benchmark-calculations/BENCHMARK-RESULTS-MW.md"
      provides: "Execution summary for Methanol and Water benchmarks"
      min_lines: 20
  key_links:
    - from: "data/benchmark/results/compound_*/B3LYP_Methanol/shifts.json"
      to: "data/benchmark/delta50/experimental_shifts.json"
      via: "molecule_id correspondence"
      pattern: "compound_\\d+"
    - from: "data/benchmark/results/compound_*/B3LYP_Water/shifts.json"
      to: "data/benchmark/delta50/experimental_shifts.json"
      via: "molecule_id correspondence"
      pattern: "compound_\\d+"
---

<objective>
Run DELTA50 benchmark calculations for Methanol and Water solvents (50 molecules x 2 solvents = 100 NWChem calculations)

Purpose: Generate calculated NMR shielding tensors for all 50 DELTA50 molecules in Methanol and Water solvents using B3LYP functional, which will be used in Phase 56 to derive solvent-specific scaling factors.
Output: 100 shifts.json files (50 Methanol + 50 Water), status tracking, and execution summary report.
</objective>

<execution_context>
@/home/chris/.claude/get-shit-done/workflows/execute-plan.md
@/home/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/54-benchmark-infrastructure/54-01-SUMMARY.md
@src/qm_nmr_calc/benchmark/runner.py
@src/qm_nmr_calc/benchmark/__main__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Execute pilot run for Methanol and Water (5 molecules, 10 calculations)</name>
  <files>data/benchmark/results/</files>
  <action>
Run a pilot benchmark with the first 5 molecules for Methanol and Water solvents to validate the pipeline before committing to the full run.

1. **Execute pilot with first 5 molecules:**
   ```bash
   python -m qm_nmr_calc.benchmark run \
     --molecules compound_01 compound_02 compound_03 compound_04 compound_05 \
     --solvents Methanol Water \
     --functionals B3LYP \
     --processes 4
   ```

2. **Verify pilot results:**
   - Check status: `python -m qm_nmr_calc.benchmark status`
   - Expect: 10 new calculations completed (5 molecules x 2 solvents)
   - Verify shifts.json files exist:
     ```bash
     ls data/benchmark/results/compound_01/B3LYP_Methanol/shifts.json
     ls data/benchmark/results/compound_01/B3LYP_Water/shifts.json
     ```

3. **Validate shielding data looks reasonable:**
   - Read a sample shifts.json and check:
     - `shielding_data` key exists and contains atom entries
     - Shielding values are in physically reasonable ranges (H: ~25-35 ppm, C: ~0-200 ppm raw shielding)
   - Note: `h1_shifts` and `c13_shifts` will be empty arrays (no scaling factors yet for these solvents). This is expected. The `shielding_data` is what matters for Phase 56.

4. **If pilot has failures:**
   - Check error messages in the CLI output
   - If >2 failures out of 10: STOP and investigate (likely a COSMO convergence issue)
   - If <=2 failures: document them and proceed (some molecules may need special handling)
   - Common failures: COSMO convergence errors, SCF non-convergence (usually molecule-specific)

This is an interactive pilot run. Do NOT use --headless.
  </action>
  <verify>
- `ls data/benchmark/results/compound_01/B3LYP_Methanol/shifts.json` exists
- `ls data/benchmark/results/compound_01/B3LYP_Water/shifts.json` exists
- At least 8 out of 10 pilot calculations completed successfully
- Sample shifts.json contains `shielding_data` with atom entries
  </verify>
  <done>
- Pilot run executed (5 molecules x 2 solvents = 10 calculations attempted)
- Methanol and Water COSMO solvation confirmed working
- Shielding data validated in expected ranges
- Any failures documented
- Ready to proceed with full run
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Pilot run completed: 5 DELTA50 molecules x Methanol + Water solvents (10 calculations)</what-built>
  <how-to-verify>
1. Check pilot results:
   ```bash
   python -m qm_nmr_calc.benchmark status
   ```

2. Verify sample output looks reasonable:
   ```bash
   python -c "
   import json
   with open('data/benchmark/results/compound_01/B3LYP_Methanol/shifts.json') as f:
       d = json.load(f)
   print(f'Methanol - H atoms: {len([a for a in d[\"shielding_data\"] if a[\"element\"]==\"H\"])}')
   print(f'Methanol - C atoms: {len([a for a in d[\"shielding_data\"] if a[\"element\"]==\"C\"])}')
   "
   ```

3. Confirm ready to proceed with full headless run (remaining 45 molecules, will take several hours)
  </how-to-verify>
  <resume-signal>Type "proceed" to continue with full headless run, or describe any issues found</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Launch full headless run for remaining Methanol and Water calculations</name>
  <files>data/benchmark/results/</files>
  <action>
Launch the full benchmark run in headless mode. The --resume flag (default: True) will skip the 10 pilot calculations already completed.

1. **Clear any existing STOP file:**
   ```bash
   rm -f data/benchmark/results/STOP
   ```

2. **Launch headless benchmark for Methanol and Water:**
   ```bash
   nohup python -m qm_nmr_calc.benchmark run \
     --solvents Methanol Water \
     --functionals B3LYP \
     --headless \
     --processes 4 \
     > /dev/null 2>&1 &
   echo "Benchmark PID: $!"
   ```

   Note: Uses --processes 4 (safe default). Adjust to --processes 8 if on a machine with 8+ cores.

3. **Verify it started:**
   ```bash
   sleep 10
   python -m qm_nmr_calc.benchmark status
   ```
   Should show state: "running" with progress incrementing past the pilot results.

4. **Provide monitoring instructions to user:**
   - Check progress: `python -m qm_nmr_calc.benchmark status`
   - View log: `tail -f data/benchmark/results/benchmark.log`
   - Stop gracefully: `python -m qm_nmr_calc.benchmark stop`

5. **Estimate completion time:**
   - Based on pilot timing, calculate: (time per calc) x 90 remaining / 3600 = estimated hours
   - Document this estimate for the user

The run continues independently. Resume support means it can be stopped and restarted across sessions.
  </action>
  <verify>
- `python -m qm_nmr_calc.benchmark status` shows state: "running"
- completed count is increasing
- current_task shows a Methanol or Water calculation
  </verify>
  <done>
- Full headless run launched for Methanol and Water
- PID and monitoring instructions provided
- Estimated completion time documented
- Run will continue independently
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full Methanol and Water benchmark dispatched (100 calculations total)</what-built>
  <how-to-verify>
The benchmark is running independently. Monitor with:

1. **Check progress anytime:**
   ```bash
   python -m qm_nmr_calc.benchmark status
   ```

2. **When complete**, status will show `state: "complete"`. Verify all 100 results:
   ```bash
   find data/benchmark/results/compound_* -path "*/B3LYP_Methanol/shifts.json" | wc -l
   find data/benchmark/results/compound_* -path "*/B3LYP_Water/shifts.json" | wc -l
   ```
   Both counts should be 50.

3. If benchmark paused due to failures: check `python -m qm_nmr_calc.benchmark status` for failure details.

Type "complete" when the benchmark finishes, or describe current status.
  </how-to-verify>
  <resume-signal>Type "complete" when all 100 calculations finish, "paused" if stopped at failure threshold, or describe status</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Verify completion and generate BENCHMARK-RESULTS-MW.md summary</name>
  <files>.planning/phases/55-delta50-benchmark-calculations/BENCHMARK-RESULTS-MW.md</files>
  <action>
Verify all Methanol and Water calculations completed and create a summary report.

1. **Count completed results:**
   ```bash
   echo "Methanol:"
   find data/benchmark/results/compound_* -path "*/B3LYP_Methanol/shifts.json" | wc -l
   echo "Water:"
   find data/benchmark/results/compound_* -path "*/B3LYP_Water/shifts.json" | wc -l
   ```
   Both should report 50.

2. **Check for any failures:**
   - Read status.json for failure records
   - If any molecules failed, list them explicitly

3. **Spot-check a few results to confirm shielding data quality:**
   - Check compound_01, compound_25, compound_50 for both solvents
   - Verify each has `shielding_data` with H and C atom entries

4. **Create BENCHMARK-RESULTS-MW.md** in the phase directory with:

```markdown
# DELTA50 Benchmark Results: Methanol & Water

**Execution Date:** {date}
**Solvents:** Methanol, Water
**Functional:** B3LYP / 6-311+G(2d,p)
**Molecules:** 50 (DELTA50 set from Grimblat et al. 2023)

## Summary

| Solvent | Completed | Failed | Success Rate |
|---------|-----------|--------|-------------|
| Methanol | X/50 | Y | Z% |
| Water | X/50 | Y | Z% |
| **Total** | **X/100** | **Y** | **Z%** |

## Failures (if any)

{List each failure: molecule_id, solvent, error message}

## Data Location

Results: `data/benchmark/results/compound_XX/B3LYP_{Methanol|Water}/shifts.json`

Each shifts.json contains:
- `shielding_data`: Raw isotropic shielding tensors (used for scaling factor derivation)
- `h1_shifts` / `c13_shifts`: Empty (no scaling factors yet for these solvents)

## Next Steps

- Plan 55-02 runs Acetone and Benzene benchmarks
- Phase 56 derives scaling factors from all 4 solvents' shielding data
```

5. **Confirm Phase 55 success criteria 1 and 2 (from ROADMAP):**
   - Methanol benchmark data directory contains 50 completed NWChem output files with NMR shielding tensors
   - Water benchmark data directory contains 50 completed NWChem output files with NMR shielding tensors
  </action>
  <verify>
- `find data/benchmark/results/compound_* -path "*/B3LYP_Methanol/shifts.json" | wc -l` outputs 50
- `find data/benchmark/results/compound_* -path "*/B3LYP_Water/shifts.json" | wc -l` outputs 50
- BENCHMARK-RESULTS-MW.md exists in phase directory with completion statistics
  </verify>
  <done>
- 50 Methanol calculations confirmed complete with shielding tensors
- 50 Water calculations confirmed complete with shielding tensors
- Summary report created documenting execution results
- BENCH-02 (methanol) and BENCH-03 (water) requirements satisfied
  </done>
</task>

</tasks>

<verification>
- [ ] Pilot run validated Methanol and Water COSMO solvation works (5 molecules each)
- [ ] Full run completed for all 50 molecules in both Methanol and Water
- [ ] 50 shifts.json files exist under B3LYP_Methanol directories
- [ ] 50 shifts.json files exist under B3LYP_Water directories
- [ ] All shifts.json files contain shielding_data with H and C atom entries
- [ ] No COSMO convergence errors (or failures documented)
- [ ] BENCHMARK-RESULTS-MW.md created with execution summary
</verification>

<success_criteria>
Methanol and Water DELTA50 benchmarks complete:
- 50 Methanol B3LYP calculations completed with shielding tensors
- 50 Water B3LYP calculations completed with shielding tensors
- Shielding data validated and ready for scaling factor derivation
- Requirements BENCH-02 and BENCH-03 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/55-delta50-benchmark-calculations/55-01-SUMMARY.md`
</output>
