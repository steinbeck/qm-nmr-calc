---
phase: 55-delta50-benchmark-calculations
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - data/benchmark/results/compound_*/B3LYP_Acetone/shifts.json
  - data/benchmark/results/compound_*/B3LYP_Benzene/shifts.json
  - data/benchmark/results/status.json
  - .planning/phases/55-delta50-benchmark-calculations/BENCHMARK-RESULTS-AB.md
autonomous: false

must_haves:
  truths:
    - "Pilot run (5 molecules x 2 solvents = 10 calculations) completes for Acetone and Benzene"
    - "Full headless run dispatched for remaining Acetone and Benzene calculations"
    - "All 50 Acetone benchmark calculations produce shifts.json with shielding_data"
    - "All 50 Benzene benchmark calculations produce shifts.json with shielding_data"
    - "No COSMO convergence errors in either solvent"
  artifacts:
    - path: "data/benchmark/results/compound_01/B3LYP_Acetone/shifts.json"
      provides: "Sample completed Acetone benchmark result"
      contains: "shielding_data"
    - path: "data/benchmark/results/compound_01/B3LYP_Benzene/shifts.json"
      provides: "Sample completed Benzene benchmark result"
      contains: "shielding_data"
    - path: ".planning/phases/55-delta50-benchmark-calculations/BENCHMARK-RESULTS-AB.md"
      provides: "Execution summary for Acetone and Benzene benchmarks"
      min_lines: 20
  key_links:
    - from: "data/benchmark/results/compound_*/B3LYP_Acetone/shifts.json"
      to: "data/benchmark/delta50/experimental_shifts.json"
      via: "molecule_id correspondence"
      pattern: "compound_\\d+"
    - from: "data/benchmark/results/compound_*/B3LYP_Benzene/shifts.json"
      to: "data/benchmark/delta50/experimental_shifts.json"
      via: "molecule_id correspondence"
      pattern: "compound_\\d+"
---

<objective>
Run DELTA50 benchmark calculations for Acetone and Benzene solvents (50 molecules x 2 solvents = 100 NWChem calculations)

Purpose: Generate calculated NMR shielding tensors for all 50 DELTA50 molecules in Acetone and Benzene solvents using B3LYP functional, which will be used in Phase 56 to derive solvent-specific scaling factors.
Output: 100 shifts.json files (50 Acetone + 50 Benzene), status tracking, and execution summary report.
</objective>

<execution_context>
@/home/chris/.claude/get-shit-done/workflows/execute-plan.md
@/home/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/54-benchmark-infrastructure/54-01-SUMMARY.md
@src/qm_nmr_calc/benchmark/runner.py
@src/qm_nmr_calc/benchmark/__main__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Execute pilot run for Acetone and Benzene (5 molecules, 10 calculations)</name>
  <files>data/benchmark/results/</files>
  <action>
Run a pilot benchmark with the first 5 molecules for Acetone and Benzene solvents to validate the pipeline before committing to the full run.

1. **Execute pilot with first 5 molecules:**
   ```bash
   python -m qm_nmr_calc.benchmark run \
     --molecules compound_01 compound_02 compound_03 compound_04 compound_05 \
     --solvents Acetone Benzene \
     --functionals B3LYP \
     --processes 4
   ```

2. **Verify pilot results:**
   - Check status: `python -m qm_nmr_calc.benchmark status`
   - Expect: 10 new calculations completed (5 molecules x 2 solvents)
   - Verify shifts.json files exist:
     ```bash
     ls data/benchmark/results/compound_01/B3LYP_Acetone/shifts.json
     ls data/benchmark/results/compound_01/B3LYP_Benzene/shifts.json
     ```

3. **Validate shielding data looks reasonable:**
   - Read a sample shifts.json and check:
     - `shielding_data` key exists and contains atom entries
     - Shielding values are in physically reasonable ranges (H: ~25-35 ppm, C: ~0-200 ppm raw shielding)
   - Note: `h1_shifts` and `c13_shifts` will be empty arrays (no scaling factors yet for these solvents). This is expected. The `shielding_data` is what matters for Phase 56.

4. **If pilot has failures:**
   - Check error messages in the CLI output
   - If >2 failures out of 10: STOP and investigate (likely a COSMO convergence issue)
   - If <=2 failures: document them and proceed (some molecules may need special handling)
   - Benzene is a newly-added solvent in input_gen.py (Phase 54) -- pay extra attention to any COSMO errors specific to benzene

This is an interactive pilot run. Do NOT use --headless.
  </action>
  <verify>
- `ls data/benchmark/results/compound_01/B3LYP_Acetone/shifts.json` exists
- `ls data/benchmark/results/compound_01/B3LYP_Benzene/shifts.json` exists
- At least 8 out of 10 pilot calculations completed successfully
- Sample shifts.json contains `shielding_data` with atom entries
  </verify>
  <done>
- Pilot run executed (5 molecules x 2 solvents = 10 calculations attempted)
- Acetone and Benzene COSMO solvation confirmed working
- Shielding data validated in expected ranges
- Any failures documented
- Ready to proceed with full run
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Pilot run completed: 5 DELTA50 molecules x Acetone + Benzene solvents (10 calculations)</what-built>
  <how-to-verify>
1. Check pilot results:
   ```bash
   python -m qm_nmr_calc.benchmark status
   ```

2. Verify sample output looks reasonable:
   ```bash
   python -c "
   import json
   with open('data/benchmark/results/compound_01/B3LYP_Acetone/shifts.json') as f:
       d = json.load(f)
   print(f'Acetone - H atoms: {len([a for a in d[\"shielding_data\"] if a[\"element\"]==\"H\"])}')
   print(f'Acetone - C atoms: {len([a for a in d[\"shielding_data\"] if a[\"element\"]==\"C\"])}')
   with open('data/benchmark/results/compound_01/B3LYP_Benzene/shifts.json') as f:
       d = json.load(f)
   print(f'Benzene - H atoms: {len([a for a in d[\"shielding_data\"] if a[\"element\"]==\"H\"])}')
   print(f'Benzene - C atoms: {len([a for a in d[\"shielding_data\"] if a[\"element\"]==\"C\"])}')
   "
   ```

3. Confirm ready to proceed with full headless run (remaining 45 molecules, will take several hours)
  </how-to-verify>
  <resume-signal>Type "proceed" to continue with full headless run, or describe any issues found</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Launch full headless run for remaining Acetone and Benzene calculations</name>
  <files>data/benchmark/results/</files>
  <action>
Launch the full benchmark run in headless mode. The --resume flag (default: True) will skip the 10 pilot calculations already completed.

**IMPORTANT:** If Plan 55-01 is running concurrently, the benchmark status.json is shared. This is fine -- the runner uses per-molecule/per-solvent output directories so there are no file conflicts. However, the status.json progress will reflect ALL running calculations (both this plan's solvents and 55-01's solvents).

1. **Clear any existing STOP file:**
   ```bash
   rm -f data/benchmark/results/STOP
   ```

2. **Launch headless benchmark for Acetone and Benzene:**
   ```bash
   nohup python -m qm_nmr_calc.benchmark run \
     --solvents Acetone Benzene \
     --functionals B3LYP \
     --headless \
     --processes 4 \
     > /dev/null 2>&1 &
   echo "Benchmark PID: $!"
   ```

   Note: Uses --processes 4 (safe default). If running concurrently with Plan 55-01, keep processes at 4 to avoid oversubscribing CPU cores.

3. **Verify it started:**
   ```bash
   sleep 10
   python -m qm_nmr_calc.benchmark status
   ```
   Should show state: "running" with progress incrementing.

4. **Provide monitoring instructions to user:**
   - Check progress: `python -m qm_nmr_calc.benchmark status`
   - Count Acetone/Benzene specifically:
     ```bash
     find data/benchmark/results/compound_* -path "*/B3LYP_Acetone/shifts.json" | wc -l
     find data/benchmark/results/compound_* -path "*/B3LYP_Benzene/shifts.json" | wc -l
     ```
   - View log: `tail -f data/benchmark/results/benchmark.log`
   - Stop gracefully: `python -m qm_nmr_calc.benchmark stop`

5. **Estimate completion time:**
   - Based on pilot timing, calculate: (time per calc) x 90 remaining / 3600 = estimated hours
   - Document this estimate for the user

The run continues independently. Resume support means it can be stopped and restarted across sessions.
  </action>
  <verify>
- `python -m qm_nmr_calc.benchmark status` shows state: "running"
- completed count is increasing
- Acetone or Benzene calculations are being produced
  </verify>
  <done>
- Full headless run launched for Acetone and Benzene
- PID and monitoring instructions provided
- Estimated completion time documented
- Run will continue independently
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full Acetone and Benzene benchmark dispatched (100 calculations total)</what-built>
  <how-to-verify>
The benchmark is running independently. Monitor with:

1. **Check progress anytime:**
   ```bash
   python -m qm_nmr_calc.benchmark status
   ```

2. **Count Acetone/Benzene results specifically:**
   ```bash
   find data/benchmark/results/compound_* -path "*/B3LYP_Acetone/shifts.json" | wc -l
   find data/benchmark/results/compound_* -path "*/B3LYP_Benzene/shifts.json" | wc -l
   ```
   Both counts should reach 50 when complete.

3. If benchmark paused due to failures: check `python -m qm_nmr_calc.benchmark status` for failure details.

Type "complete" when the benchmark finishes, or describe current status.
  </how-to-verify>
  <resume-signal>Type "complete" when all 100 calculations finish, "paused" if stopped at failure threshold, or describe status</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Verify completion and generate BENCHMARK-RESULTS-AB.md summary</name>
  <files>.planning/phases/55-delta50-benchmark-calculations/BENCHMARK-RESULTS-AB.md</files>
  <action>
Verify all Acetone and Benzene calculations completed and create a summary report.

1. **Count completed results:**
   ```bash
   echo "Acetone:"
   find data/benchmark/results/compound_* -path "*/B3LYP_Acetone/shifts.json" | wc -l
   echo "Benzene:"
   find data/benchmark/results/compound_* -path "*/B3LYP_Benzene/shifts.json" | wc -l
   ```
   Both should report 50.

2. **Check for any failures:**
   - Read status.json for failure records
   - If any molecules failed, list them explicitly

3. **Spot-check a few results to confirm shielding data quality:**
   - Check compound_01, compound_25, compound_50 for both solvents
   - Verify each has `shielding_data` with H and C atom entries

4. **Create BENCHMARK-RESULTS-AB.md** in the phase directory with:

```markdown
# DELTA50 Benchmark Results: Acetone & Benzene

**Execution Date:** {date}
**Solvents:** Acetone, Benzene
**Functional:** B3LYP / 6-311+G(2d,p)
**Molecules:** 50 (DELTA50 set from Grimblat et al. 2023)

## Summary

| Solvent | Completed | Failed | Success Rate |
|---------|-----------|--------|-------------|
| Acetone | X/50 | Y | Z% |
| Benzene | X/50 | Y | Z% |
| **Total** | **X/100** | **Y** | **Z%** |

## Failures (if any)

{List each failure: molecule_id, solvent, error message}

## Data Location

Results: `data/benchmark/results/compound_XX/B3LYP_{Acetone|Benzene}/shifts.json`

Each shifts.json contains:
- `shielding_data`: Raw isotropic shielding tensors (used for scaling factor derivation)
- `h1_shifts` / `c13_shifts`: Empty (no scaling factors yet for these solvents)

## Next Steps

- Phase 56 derives scaling factors from all 4 new solvents' shielding data
```

5. **Confirm Phase 55 success criteria 3 and 4 (from ROADMAP):**
   - Acetone benchmark data directory contains 50 completed NWChem output files with NMR shielding tensors
   - Benzene benchmark data directory contains 50 completed NWChem output files with NMR shielding tensors

6. **If both Plan 55-01 and 55-02 are complete, also confirm success criterion 5:**
   - No benchmark molecule fails with a COSMO convergence error (all 200 calculations parse cleanly)
   - Count total: Methanol (50) + Water (50) + Acetone (50) + Benzene (50) = 200
  </action>
  <verify>
- `find data/benchmark/results/compound_* -path "*/B3LYP_Acetone/shifts.json" | wc -l` outputs 50
- `find data/benchmark/results/compound_* -path "*/B3LYP_Benzene/shifts.json" | wc -l` outputs 50
- BENCHMARK-RESULTS-AB.md exists in phase directory with completion statistics
  </verify>
  <done>
- 50 Acetone calculations confirmed complete with shielding tensors
- 50 Benzene calculations confirmed complete with shielding tensors
- Summary report created documenting execution results
- BENCH-04 (acetone) and BENCH-05 (benzene) requirements satisfied
  </done>
</task>

</tasks>

<verification>
- [ ] Pilot run validated Acetone and Benzene COSMO solvation works (5 molecules each)
- [ ] Full run completed for all 50 molecules in both Acetone and Benzene
- [ ] 50 shifts.json files exist under B3LYP_Acetone directories
- [ ] 50 shifts.json files exist under B3LYP_Benzene directories
- [ ] All shifts.json files contain shielding_data with H and C atom entries
- [ ] No COSMO convergence errors (or failures documented)
- [ ] BENCHMARK-RESULTS-AB.md created with execution summary
</verification>

<success_criteria>
Acetone and Benzene DELTA50 benchmarks complete:
- 50 Acetone B3LYP calculations completed with shielding tensors
- 50 Benzene B3LYP calculations completed with shielding tensors
- Shielding data validated and ready for scaling factor derivation
- Requirements BENCH-04 and BENCH-05 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/55-delta50-benchmark-calculations/55-02-SUMMARY.md`
</output>
