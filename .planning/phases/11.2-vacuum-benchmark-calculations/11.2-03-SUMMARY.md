# Phase 11.2 Plan 03: Derive Vacuum Scaling Factors Summary

**One-liner:** Vacuum scaling factors derived via OLS regression (1H R^2=0.993, 13C R^2=0.998) and integrated into production shift conversion

## What Was Done

### Task 1: Derive vacuum scaling factors
- Aggregated regression data from 50 DELTA50 molecules (342 1H points, 221 13C points)
- Fitted OLS regression with 3-sigma outlier removal
- Results:
  - 1H vacuum: slope=-0.9554, intercept=30.54, R^2=0.9934, MAE=0.148 ppm
  - 13C vacuum: slope=-0.9726, intercept=175.71, R^2=0.9980, MAE=1.739 ppm
- Generated regression and residual plots
- Updated SCALING-FACTORS.md with vacuum statistics and per-compound analysis
- Commit: 9bd8092

### Task 2: Update production scaling factors
- Added vacuum entries to `src/qm_nmr_calc/data/scaling_factors.json`
- Production now supports 6 factor combinations (CHCl3, DMSO, vacuum x 1H/13C)
- Verified `get_scaling_factor()` retrieves vacuum factors correctly
- Commit: 1908a89

### Task 3: Update shifts.py solvent normalization
- Added "vacuum" to solvent_map for explicit normalization
- Updated docstrings to document vacuum as valid solvent option
- Verified `shielding_to_shift()` works with vacuum in all case variants
- Commit: e296a52

## Deviations from Plan

None - plan executed exactly as written.

## Key Decisions

| Decision | Rationale | Impact |
|----------|-----------|--------|
| Use Option A (merge factors) | Faster than regenerating full report | Minimal - vacuum sections added manually |
| Add vacuum explicitly to solvent_map | Explicit is better than implicit fallback | Clearer code intent |

## Files Modified

| File | Change Type | Purpose |
|------|-------------|---------|
| data/benchmark/delta50/scaling_factors.json | Modified | Added vacuum 1H and 13C factors |
| data/benchmark/delta50/SCALING-FACTORS.md | Modified | Added vacuum stats, plots, tables |
| data/benchmark/delta50/plots/B3LYP_vacuum_*.png | Created | Regression and residual plots (4 files) |
| src/qm_nmr_calc/data/scaling_factors.json | Modified | Added vacuum factors to production |
| src/qm_nmr_calc/shifts.py | Modified | Added vacuum to solvent normalization |

## Testing

- All 92 non-NWChem tests pass (3 NWChem integration tests fail as expected without NWChem)
- Verified vacuum factor lookup works
- Verified shielding_to_shift() with vacuum produces correct shifts
- Verified vacuum MAE within 2x of solvated factors

## Metrics

| Metric | Value |
|--------|-------|
| Duration | 7 minutes |
| Tasks completed | 3/3 |
| Files modified | 6 |
| Tests passing | 92/95 (3 expected failures) |

## Vacuum Scaling Factor Statistics

| Nucleus | Solvent | Slope | Intercept | R^2 | MAE (ppm) | n_points |
|---------|---------|-------|-----------|-----|-----------|----------|
| 1H | vacuum | -0.9554 | 30.54 | 0.9934 | 0.148 | 336 |
| 13C | vacuum | -0.9726 | 175.71 | 0.9980 | 1.739 | 219 |
| 1H | CHCl3 | -0.9375 | 29.92 | 0.9952 | 0.124 | 335 |
| 13C | CHCl3 | -0.9497 | 172.69 | 0.9978 | 1.949 | 219 |

Vacuum factors show slightly higher MAE for 1H (0.148 vs 0.124 ppm) but lower MAE for 13C (1.739 vs 1.949 ppm), both with excellent R^2 > 0.99.

## Next Steps

Phase 11.2 (Vacuum Benchmark Calculations) is now complete. All 50 molecules calculated, scaling factors derived, and production system updated.

Ready to continue with remaining roadmap phases.
