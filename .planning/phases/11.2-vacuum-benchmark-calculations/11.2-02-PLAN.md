---
phase: 11.2-vacuum-benchmark-calculations
plan: 02
type: execute
wave: 2
depends_on: ["11.2-01"]
files_modified:
  - data/benchmark/results/compound_*/B3LYP_vacuum/shifts.json
autonomous: false

must_haves:
  truths:
    - "All 50 DELTA50 molecules calculated with B3LYP in vacuum"
    - "shifts.json files exist for all 50 compounds in B3LYP_vacuum directories"
    - "Shielding data captured for 1H and 13C atoms"
  artifacts:
    - path: "data/benchmark/results/compound_01/B3LYP_vacuum/shifts.json"
      provides: "Vacuum NMR shielding data for compound_01"
    - path: "data/benchmark/results/status.json"
      provides: "Benchmark run status"
      contains: "complete"
  key_links:
    - from: "data/benchmark/results/compound_*/B3LYP_vacuum/shifts.json"
      to: "shielding_data"
      via: "JSON key containing raw shielding values"
      pattern: "shielding_data"
---

<objective>
Execute DELTA50 vacuum benchmark: 50 B3LYP calculations without COSMO solvation

Purpose: Generate NMR shielding data for gas-phase scaling factor derivation
Output: 50 shifts.json files in data/benchmark/results/compound_XX/B3LYP_vacuum/
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11.2-vacuum-benchmark-calculations/11.2-01-SUMMARY.md

@src/qm_nmr_calc/benchmark/runner.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run pilot vacuum calculations (5 molecules)</name>
  <files>data/benchmark/results/compound_01/B3LYP_vacuum/</files>
  <action>
Run pilot benchmark with 5 molecules to verify vacuum calculations work:

```bash
cd /home/chris/develop/qm-nmr-calc
uv run python -m qm_nmr_calc.benchmark run \
    --functionals B3LYP \
    --solvents vacuum \
    --molecules compound_01,compound_02,compound_03,compound_04,compound_05 \
    --processes 8
```

If the CLI doesn't support --molecules filter, use Python directly:

```python
from qm_nmr_calc.benchmark.runner import run_benchmark

results, state = run_benchmark(
    molecules=["compound_01", "compound_02", "compound_03", "compound_04", "compound_05"],
    functionals=["B3LYP"],
    solvents=["vacuum"],
    processes=8,
    resume=True,
)
print(f"Completed: {len([r for r in results if r.status == 'complete'])}")
print(f"State: {state}")
```

Monitor progress via status.json or tqdm output.
Expect ~5 minutes per calculation (5 molecules x ~5 min = ~25 min).
  </action>
  <verify>
Check pilot results:
```bash
# Verify shifts.json exists for pilot molecules
ls -la /home/chris/develop/qm-nmr-calc/data/benchmark/results/compound_0{1,2,3,4,5}/B3LYP_vacuum/shifts.json

# Check status
cat /home/chris/develop/qm-nmr-calc/data/benchmark/results/status.json | python -m json.tool
```

Verify shielding data captured (no shift conversion expected yet):
```python
import orjson
from pathlib import Path

shifts_file = Path("/home/chris/develop/qm-nmr-calc/data/benchmark/results/compound_01/B3LYP_vacuum/shifts.json")
data = orjson.loads(shifts_file.read_bytes())

# Should have shielding_data
assert "shielding_data" in data
assert len(data["shielding_data"]["index"]) > 0
print(f"H atoms: {sum(1 for a in data['shielding_data']['atom'] if a == 'H')}")
print(f"C atoms: {sum(1 for a in data['shielding_data']['atom'] if a == 'C')}")
```
  </verify>
  <done>
- 5 pilot molecules completed successfully with B3LYP/vacuum
- shifts.json files exist with shielding_data
- No errors in NWChem execution without COSMO
  </done>
</task>

<task type="auto">
  <name>Task 2: Run full vacuum benchmark (remaining 45 molecules)</name>
  <files>data/benchmark/results/compound_*/B3LYP_vacuum/</files>
  <action>
Run full benchmark in headless mode for remaining molecules:

```bash
cd /home/chris/develop/qm-nmr-calc
nohup uv run python -m qm_nmr_calc.benchmark run \
    --functionals B3LYP \
    --solvents vacuum \
    --headless \
    --processes 8 \
    > benchmark_vacuum.log 2>&1 &

echo "Benchmark PID: $!"
```

Or using Python directly for better control:

```python
from qm_nmr_calc.benchmark.runner import run_benchmark

# Resume will skip already-completed molecules from pilot
results, state = run_benchmark(
    functionals=["B3LYP"],
    solvents=["vacuum"],
    processes=8,
    headless=True,
    resume=True,  # Skip pilot molecules
)
print(f"Final state: {state}")
print(f"Completed: {len([r for r in results if r.status == 'complete'])}")
```

Expected duration: ~45 molecules x ~2 min each = ~90 minutes
(Vacuum calculations faster than solvated due to no COSMO overhead)

Monitor progress:
```bash
watch -n 30 'cat /home/chris/develop/qm-nmr-calc/data/benchmark/results/status.json | python -m json.tool'
```
  </action>
  <verify>
After completion, verify all 50 molecules have results:

```bash
# Count completed vacuum calculations
ls -d /home/chris/develop/qm-nmr-calc/data/benchmark/results/compound_*/B3LYP_vacuum 2>/dev/null | wc -l

# Count shifts.json files
ls /home/chris/develop/qm-nmr-calc/data/benchmark/results/compound_*/B3LYP_vacuum/shifts.json 2>/dev/null | wc -l

# Check final status
cat /home/chris/develop/qm-nmr-calc/data/benchmark/results/status.json | python -m json.tool
```

Should show 50 completed calculations.
  </verify>
  <done>
- All 50 DELTA50 molecules have B3LYP_vacuum/shifts.json
- status.json shows state: "complete"
- No failed calculations (or failures documented)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>50 vacuum NMR calculations for DELTA50 benchmark set</what-built>
  <how-to-verify>
1. Verify calculation completion:
   ```bash
   ls /home/chris/develop/qm-nmr-calc/data/benchmark/results/compound_*/B3LYP_vacuum/shifts.json | wc -l
   ```
   Expected: 50

2. Check for any failures in status.json:
   ```bash
   cat /home/chris/develop/qm-nmr-calc/data/benchmark/results/status.json | python -m json.tool
   ```
   Expected: state = "complete", failed = 0

3. Spot-check a few results:
   ```bash
   cat /home/chris/develop/qm-nmr-calc/data/benchmark/results/compound_25/B3LYP_vacuum/shifts.json | python -m json.tool | head -30
   ```
   Should have shielding_data with index, atom, shielding arrays

4. If any failures, check benchmark.log:
   ```bash
   tail -100 /home/chris/develop/qm-nmr-calc/data/benchmark/results/benchmark.log
   ```
  </how-to-verify>
  <resume-signal>Type "approved" if 50/50 calculations complete, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Full verification after human approval:

1. Count verification:
   ```bash
   echo "Total B3LYP_vacuum directories: $(ls -d data/benchmark/results/compound_*/B3LYP_vacuum 2>/dev/null | wc -l)"
   echo "Total shifts.json files: $(ls data/benchmark/results/compound_*/B3LYP_vacuum/shifts.json 2>/dev/null | wc -l)"
   ```

2. Data integrity check:
   ```python
   import orjson
   from pathlib import Path

   results_dir = Path("data/benchmark/results")
   errors = []
   for mol_dir in sorted(results_dir.glob("compound_*")):
       shifts_file = mol_dir / "B3LYP_vacuum" / "shifts.json"
       if not shifts_file.exists():
           errors.append(f"Missing: {shifts_file}")
           continue
       data = orjson.loads(shifts_file.read_bytes())
       if "shielding_data" not in data:
           errors.append(f"No shielding_data: {shifts_file}")

   print(f"Errors: {len(errors)}")
   for e in errors[:10]:
       print(e)
   ```
</verification>

<success_criteria>
- [ ] 50/50 DELTA50 molecules have B3LYP_vacuum/shifts.json
- [ ] All shifts.json files contain valid shielding_data
- [ ] status.json shows state="complete"
- [ ] No calculation failures (or failures documented)
- [ ] Human verified results
</success_criteria>

<output>
After completion, create `.planning/phases/11.2-vacuum-benchmark-calculations/11.2-02-SUMMARY.md`
</output>
