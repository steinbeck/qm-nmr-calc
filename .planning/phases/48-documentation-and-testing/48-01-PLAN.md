---
phase: 48-documentation-and-testing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/deployment.md
  - README.md
autonomous: true

must_haves:
  truths:
    - "User can find GCP deployment option in README"
    - "User can see full GCP prerequisites before starting"
    - "User can estimate monthly costs before deploying"
    - "User understands job loss risk during preemption"
    - "User can configure DNS with common providers"
  artifacts:
    - path: "docs/deployment.md"
      provides: "GCP deployment section with prerequisites, costs, preemption, DNS guide"
      contains: "## Google Cloud Platform Deployment"
    - path: "README.md"
      provides: "Brief GCP mention with link to deployment guide"
      contains: "GCP Spot VM"
  key_links:
    - from: "README.md"
      to: "docs/deployment.md"
      via: "link in deployment section"
      pattern: "\\[.*GCP.*\\]\\(docs/deployment.md\\)"
---

<objective>
Document GCP Spot VM deployment for qm-nmr-calc.

Purpose: Users can deploy to GCP with clear guidance on prerequisites, costs, and limitations. This completes the v2.6 milestone by making the GCP deployment scripts accessible to users who are not familiar with gcloud commands.

Output: Updated docs/deployment.md with comprehensive GCP section, updated README.md with brief GCP mention.
</objective>

<execution_context>
@/Users/steinbeck/.claude/get-shit-done/workflows/execute-plan.md
@/Users/steinbeck/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@docs/deployment.md
@README.md
@gcp/config.sh.example
@gcp/setup-infrastructure.sh
@gcp/deploy-vm.sh
@gcp/stop-vm.sh
@gcp/start-vm.sh
@gcp/delete-vm.sh
@gcp/status-vm.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GCP Deployment Section to docs/deployment.md</name>
  <files>docs/deployment.md</files>
  <action>
Add a comprehensive "## Google Cloud Platform Deployment" section to docs/deployment.md AFTER the existing "## Architecture" section. Include:

**Structure:**
```
## Google Cloud Platform Deployment

Deploy qm-nmr-calc to a cost-effective GCP Spot VM with manual lifecycle management.

### Why GCP Spot VMs?

[Explain 60-91% cost savings vs on-demand, ~$0.03-0.05/hour for e2-standard-4]

### Prerequisites

[GCP account with billing, gcloud CLI installed and authenticated, domain name for HTTPS]

### Cost Estimates

[Table with Spot vs On-demand for e2-standard-4, static IP charges, persistent disk costs]
| Resource | Spot Pricing | On-Demand Pricing | Notes |
|----------|--------------|-------------------|-------|
| e2-standard-4 (4 vCPU, 16 GB) | ~$30-50/month | ~$100-150/month | Primary compute cost |
| Static IP (attached) | Free | Free | While VM is running |
| Static IP (detached) | ~$7/month | ~$7/month | When VM is stopped |
| Persistent Disk (100 GB SSD) | ~$17/month | ~$17/month | Always billed |

### Preemption and Job Loss

[IMPORTANT warning box explaining:
- GCP can reclaim Spot VMs with 30 seconds notice
- Jobs in progress WILL be lost (no checkpoint/restart)
- Persistent disk survives - completed job data is preserved
- Use stop-vm.sh when not running calculations to avoid surprise preemption]

### Quick Start

[Step-by-step workflow:
1. cd gcp && cp config.sh.example config.sh
2. Edit config.sh with your GCP project ID
3. ./setup-infrastructure.sh (creates IP, firewall, disk)
4. Configure DNS (point domain to static IP)
5. ./deploy-vm.sh (creates VM, deploys containers)
6. Wait ~3 minutes for startup, access https://your-domain.com]

### DNS Configuration

#### Cloudflare
[A record instructions, proxy off for initial setup]

#### Namecheap
[A record in Advanced DNS]

#### General Instructions
[Generic A record pointing to static IP, TTL, propagation wait]

### Lifecycle Management

| Task | Command | Description |
|------|---------|-------------|
| Stop VM | ./stop-vm.sh | Stop billing, preserve data |
| Start VM | ./start-vm.sh | Resume VM, services auto-start |
| Delete VM | ./delete-vm.sh | Remove VM, keep disk and IP |
| Check Status | ./status-vm.sh | Show VM state, IP, containers |
| SSH Access | ./ssh-vm.sh | Open shell on VM |
| View Logs | ./logs-vm.sh | Stream container logs |

### Troubleshooting GCP Deployment

[Common issues:
- VM won't start: Quota limits, Spot availability
- HTTPS not working: DNS propagation, firewall rules
- Containers not running: Check logs-vm.sh output]
```

**Style notes:**
- Match the existing deployment.md tone and formatting
- Use the same header hierarchy (##, ###, ####)
- Include command examples with bash code blocks
- Add callout boxes for warnings (preemption especially)
  </action>
  <verify>
- grep -q "Google Cloud Platform Deployment" docs/deployment.md
- grep -q "Preemption" docs/deployment.md
- grep -q "setup-infrastructure.sh" docs/deployment.md
- grep -q "Cloudflare" docs/deployment.md
  </verify>
  <done>
- GCP deployment section exists in docs/deployment.md
- Prerequisites section covers GCP account, gcloud CLI, domain
- Cost estimates table shows Spot vs On-demand pricing
- Preemption warning clearly states jobs will be lost
- DNS configuration covers Cloudflare and Namecheap
- Quick start workflow is complete and accurate
- Lifecycle management commands are documented
  </done>
</task>

<task type="auto">
  <name>Task 2: Update README.md with GCP Mention</name>
  <files>README.md</files>
  <action>
Update README.md to mention GCP deployment as an option. Make TWO changes:

1. **In the "Quick Start (Docker)" section**, after the "For production deployment with HTTPS..." line, add a brief GCP mention:

```markdown
For production deployment with HTTPS, cloud VPS setup, and troubleshooting, see the **[Deployment Guide](docs/deployment.md)**.

**Cloud Options:**
- **Self-managed VPS**: Any cloud provider (DigitalOcean, Linode, etc.) - see Deployment Guide
- **GCP Spot VM**: Cost-effective Google Cloud deployment (~$30-50/month) with lifecycle scripts - see [GCP Deployment](docs/deployment.md#google-cloud-platform-deployment)
```

2. **No other changes needed** - the existing structure is good. Do not modify other sections.

**Style notes:**
- Keep it brief - README should link to docs, not duplicate them
- Highlight the cost benefit (~$30-50/month Spot pricing)
- Use the same bold link style as existing README
  </action>
  <verify>
- grep -q "GCP Spot VM" README.md
- grep -q "docs/deployment.md#google-cloud-platform-deployment" README.md
  </verify>
  <done>
- README mentions GCP as a deployment option
- Link points to the specific GCP section in deployment.md
- Cost benefit is mentioned (~$30-50/month)
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify Documentation Renders Correctly</name>
  <files>docs/deployment.md, README.md</files>
  <action>
Verify the documentation is well-formed:

1. Check markdown syntax is valid (no broken links, proper heading hierarchy)
2. Verify internal links work:
   - README.md link to docs/deployment.md exists
   - README.md anchor link to #google-cloud-platform-deployment will work
3. Check no duplicate sections were accidentally created
4. Ensure consistent formatting with existing docs

Run these verification commands:
```bash
# Check docs/deployment.md structure
grep -n "^## " docs/deployment.md  # Should show logical section order

# Check README links
grep -o '\[.*\](docs/[^)]*' README.md  # Should show valid doc links

# Check GCP section has expected subsections
grep -n "^### " docs/deployment.md | grep -A20 "GCP"  # Should show Prerequisites, Cost, etc.
```
  </action>
  <verify>
- All markdown headers follow proper hierarchy (no skipped levels)
- Internal links point to existing files
- GCP section appears after Architecture section in deployment.md
- No duplicate "## Google Cloud Platform Deployment" sections
  </verify>
  <done>
- Documentation renders correctly
- All links are valid
- Section order is logical
- Formatting is consistent with existing docs
  </done>
</task>

</tasks>

<verification>
After completing all tasks, verify the phase requirements are satisfied:

1. **DOCS-01** (README section on GCP deployment):
   ```bash
   grep -q "GCP Spot VM" README.md && echo "DOCS-01: PASS"
   ```

2. **DOCS-02** (Prerequisites documented):
   ```bash
   grep -q "gcloud CLI" docs/deployment.md && \
   grep -q "GCP account" docs/deployment.md && \
   grep -q "domain" docs/deployment.md && echo "DOCS-02: PASS"
   ```

3. **DOCS-03** (Cost estimates documented):
   ```bash
   grep -q "Spot Pricing" docs/deployment.md && \
   grep -q "On-Demand Pricing" docs/deployment.md && echo "DOCS-03: PASS"
   ```

4. **DOCS-04** (Preemption limitations documented):
   ```bash
   grep -q "jobs in progress" docs/deployment.md && \
   grep -q "will be lost" docs/deployment.md && echo "DOCS-04: PASS"
   ```

5. **DOCS-05** (DNS configuration guide):
   ```bash
   grep -q "Cloudflare" docs/deployment.md && \
   grep -q "Namecheap" docs/deployment.md && echo "DOCS-05: PASS"
   ```
</verification>

<success_criteria>
1. README mentions GCP Spot VM deployment with link to deployment guide
2. docs/deployment.md has comprehensive GCP section with:
   - Prerequisites (GCP account, gcloud CLI, domain)
   - Cost estimates table (Spot vs On-demand)
   - Preemption warning (jobs will be lost)
   - Quick start workflow (6 steps)
   - DNS configuration (Cloudflare, Namecheap, general)
   - Lifecycle management command reference
3. All 5 DOCS-* requirements pass verification
4. Documentation renders correctly with no broken links
</success_criteria>

<output>
After completion, create `.planning/phases/48-documentation-and-testing/48-01-SUMMARY.md`
</output>
