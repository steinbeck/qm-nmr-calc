---
phase: 19-results-redesign
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/qm_nmr_calc/api/static/css/pages/results-page.css
autonomous: true

must_haves:
  truths:
    - "3D viewer card uses solid white background (not glass) for WebGL performance"
    - "Shift tables display numbers right-aligned with tabular figures"
    - "Spectrum images scale properly within cards without distortion"
    - "Download buttons have adequate touch targets (44px min-height)"
  artifacts:
    - path: "src/qm_nmr_calc/api/static/css/pages/results-page.css"
      provides: "Page-specific components for results bento layout"
      contains: ".viewer-card"
  key_links:
    - from: "results-page.css"
      to: "tokens.css"
      via: "CSS custom property references"
      pattern: "var\\(--"
---

<objective>
Create results-page.css with viewer-card and page-specific styling components for the results page bento layout.

Purpose: Provides specialized components that Phase 18's generic glass-card and bento-grid cannot cover -- specifically the 3D viewer card (solid background for WebGL), shift tables with tabular figures, spectrum image containers, and download button grid.

Output: `src/qm_nmr_calc/api/static/css/pages/results-page.css` with all components needed for Plan 19-02 template update.
</objective>

<execution_context>
@/home/chris/.claude/get-shit-done/workflows/execute-plan.md
@/home/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-results-redesign/19-RESEARCH.md

# Phase 18 CSS for reference
@src/qm_nmr_calc/api/static/css/tokens.css
@src/qm_nmr_calc/api/static/css/components/glass-card.css
@src/qm_nmr_calc/api/static/css/layout.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create pages directory and results-page.css</name>
  <files>src/qm_nmr_calc/api/static/css/pages/results-page.css</files>
  <action>
Create the pages directory and results-page.css file with the following components:

**File structure:**
```
src/qm_nmr_calc/api/static/css/pages/results-page.css
```

**CSS components to implement (all in @layer components):**

1. **Results Header** (.results-header)
   - Bottom margin: var(--space-xl)
   - h1 with margin: 0, font-size: var(--text-2xl)

2. **Viewer Card** (.viewer-card) - CRITICAL: Solid background, NOT glass
   - background: var(--color-white) -- solid white for WebGL performance
   - border: 1px solid var(--color-border)
   - border-radius: var(--glass-radius)
   - box-shadow: var(--glass-shadow)
   - padding: var(--space-lg)
   - display: flex, flex-direction: column, height: 100%

3. **Viewer Card Elements:**
   - .viewer-card__header: flex row, justify-content: space-between, align-items: center, gap: var(--space-md), margin-bottom: var(--space-md), padding-bottom: var(--space-md), border-bottom: 1px solid var(--color-border), flex-wrap: wrap
   - .viewer-card__title: font-size: var(--text-xl), font-weight: 600, margin: 0
   - .viewer-card__controls: flex row, align-items: center, gap: var(--space-sm)
   - .viewer-card__canvas: flex: 1, min-height: 350px, position: relative (REQUIRED for 3Dmol.js), isolation: isolate (prevents compositing issues), background: white, border-radius: var(--space-xs), border: 1px solid var(--color-gray-200)
   - .viewer-card__footer: margin-top: var(--space-md), padding-top: var(--space-md), border-top: 1px solid var(--color-border)

4. **Conformer Selector** (.conformer-select)
   - background: var(--color-white) -- solid for accessibility
   - border: 1px solid var(--color-border)
   - border-radius: var(--space-xs)
   - padding: var(--space-xs) var(--space-sm)
   - font-size: var(--text-sm)
   - min-width: 200px
   - cursor: pointer
   - :focus with outline: 2px solid var(--color-primary), outline-offset: 2px

5. **Conformer Info** (.conformer-info)
   - font-size: var(--text-sm)
   - color: var(--color-text-muted)
   - font-style: italic

6. **Spectrum Figure** (.spectrum-figure, .spectrum-figure__image)
   - .spectrum-figure: margin: 0, text-align: center
   - .spectrum-figure__image: max-width: 100%, height: auto, max-height: 280px, object-fit: contain, border-radius: var(--space-xs), cursor: pointer, transition for transform and box-shadow
   - @media (hover: hover) hover effect: transform: scale(1.02), box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15)

7. **Shift Table** (.shift-table)
   - width: 100%, border-collapse: collapse
   - th, td: padding: var(--space-sm) var(--space-md), text-align: left, border-bottom: 1px solid var(--color-border)
   - th: font-weight: 600, color: var(--color-text-muted), font-size: var(--text-sm), text-transform: uppercase, letter-spacing: 0.5px
   - td:last-child, th:last-child: text-align: right, font-variant-numeric: tabular-nums
   - td:last-child: font-family: var(--font-mono)
   - tbody tr:last-child td: border-bottom: none

8. **Metadata List** (.metadata-list, .metadata-list__item)
   - .metadata-list: display: grid, grid-template-columns: repeat(2, 1fr), gap: var(--space-sm)
   - .metadata-list__item: display: flex, flex-direction: column
   - dt: font-size: var(--text-sm), color: var(--color-text-muted), margin-bottom: var(--space-xs)
   - dd: margin: 0, font-weight: 500

9. **Download Grid** (.download-grid, .download-btn)
   - .download-grid: display: grid, grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)), gap: var(--space-sm)
   - .download-btn: flex column, align-items: center, gap: var(--space-xs), padding: var(--space-md), background: var(--color-gray-50), border: 1px solid var(--color-border), border-radius: var(--space-sm), text-decoration: none, color: var(--color-text), min-height: 44px (touch target), transition for background and border-color
   - .download-btn:hover: background: var(--color-gray-100), border-color: var(--color-primary)
   - .download-btn__label: font-size: var(--text-sm), text-align: center

10. **Conformer Table** (.conformer-table) - for top contributors
    - width: 100%, border-collapse: collapse, margin-top: var(--space-sm), font-size: var(--text-sm)
    - th, td: padding: var(--space-xs) var(--space-sm), text-align: left, border-bottom: 1px solid var(--color-border)
    - th: font-weight: 600, color: var(--color-text-muted)
    - td:nth-child(2), td:nth-child(3): text-align: right, font-variant-numeric: tabular-nums

11. **Ensemble Note** (.ensemble-note)
    - padding: var(--space-md)
    - background: var(--color-primary-light)
    - border-left: 4px solid var(--color-primary)
    - border-radius: var(--space-xs)
    - font-size: var(--text-sm)
    - margin-top: var(--space-md)

12. **Back Link** (.back-link)
    - margin-top: var(--space-xl)
    - text-align: center

**Important:** All styles must be inside @layer components {} to integrate with Phase 18 cascade layers.
  </action>
  <verify>
1. File exists: `ls -la src/qm_nmr_calc/api/static/css/pages/results-page.css`
2. Contains @layer components: `grep -c "@layer components" src/qm_nmr_calc/api/static/css/pages/results-page.css`
3. Has viewer-card (solid bg): `grep -c "\.viewer-card" src/qm_nmr_calc/api/static/css/pages/results-page.css`
4. Has tabular-nums: `grep -c "tabular-nums" src/qm_nmr_calc/api/static/css/pages/results-page.css`
5. Has min-height touch target: `grep "min-height.*44px" src/qm_nmr_calc/api/static/css/pages/results-page.css`
  </verify>
  <done>
results-page.css exists with all 12 component groups, uses @layer components, viewer-card has solid white background (not glass), tables use tabular-nums for aligned numbers, download buttons have 44px min-height for touch targets.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add screen reader utility class</name>
  <files>src/qm_nmr_calc/api/static/css/utilities.css</files>
  <action>
Add a screen-reader-only utility class (.sr-only) to utilities.css if not already present. This is needed for the conformer selector label to be accessible but visually hidden.

Check if .sr-only exists:
```bash
grep -c "\.sr-only" src/qm_nmr_calc/api/static/css/utilities.css
```

If not present, add to utilities.css inside @layer utilities:

```css
/* Screen reader only - visually hidden but accessible */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}
```
  </action>
  <verify>
`grep "\.sr-only" src/qm_nmr_calc/api/static/css/utilities.css` returns the class definition
  </verify>
  <done>
.sr-only utility class available in utilities.css for accessible hidden labels.
  </done>
</task>

</tasks>

<verification>
1. CSS file created in correct location under pages/ directory
2. All component classes use var(--*) tokens from Phase 18
3. Viewer card uses solid background (var(--color-white)), not glass-bg-*
4. Shift tables use font-variant-numeric: tabular-nums for aligned numbers
5. No syntax errors in CSS (browser console check when loaded)
</verification>

<success_criteria>
- results-page.css file exists with ~200+ lines of CSS
- All 12 component groups implemented with BEM naming
- viewer-card uses solid white background (critical for 3D viewer performance)
- .sr-only utility available for accessible form labels
- CSS integrates with @layer components cascade layer
</success_criteria>

<output>
After completion, create `.planning/phases/19-results-redesign/19-01-SUMMARY.md`
</output>
