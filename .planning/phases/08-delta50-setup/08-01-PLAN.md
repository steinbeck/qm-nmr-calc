---
phase: 08-delta50-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - data/benchmark/delta50/molecules/*.xyz
  - data/benchmark/delta50/experimental_shifts.json
  - src/qm_nmr_calc/benchmark/__init__.py
  - src/qm_nmr_calc/benchmark/models.py
  - src/qm_nmr_calc/benchmark/data_loader.py
autonomous: true

must_haves:
  truths:
    - "50 DELTA50 molecule XYZ files exist in data/benchmark/delta50/molecules/"
    - "Experimental shifts JSON contains 1H and 13C data for all 50 molecules"
    - "Python can load molecules via data_loader.load_delta50_molecules()"
    - "Python can load experimental shifts via data_loader.load_experimental_shifts()"
  artifacts:
    - path: "data/benchmark/delta50/molecules/"
      provides: "50 XYZ structure files from DELTA50 SI"
      contains: "*.xyz files"
    - path: "data/benchmark/delta50/experimental_shifts.json"
      provides: "Experimental 1H and 13C shifts for all molecules"
      min_lines: 50
    - path: "src/qm_nmr_calc/benchmark/models.py"
      provides: "Pydantic models for benchmark data"
      exports: ["MoleculeData", "ExperimentalShifts", "BenchmarkResult"]
    - path: "src/qm_nmr_calc/benchmark/data_loader.py"
      provides: "Functions to load DELTA50 data"
      exports: ["load_delta50_molecules", "load_experimental_shifts"]
  key_links:
    - from: "src/qm_nmr_calc/benchmark/data_loader.py"
      to: "data/benchmark/delta50/"
      via: "Path resolution"
      pattern: "benchmark.*delta50"
---

<objective>
Acquire DELTA50 benchmark data and create Python infrastructure to load it

Purpose: Establish the 50-molecule benchmark dataset with experimental shifts, and provide Python functions to load this data for benchmark execution.
Output: 50 XYZ files, experimental shifts JSON, and benchmark/data_loader.py module
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-delta50-setup/08-CONTEXT.md
@.planning/phases/08-delta50-setup/08-RESEARCH.md

# Existing codebase patterns
@src/qm_nmr_calc/nwchem/geometry.py
@src/qm_nmr_calc/models.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Download and commit DELTA50 molecule structures</name>
  <files>
    data/benchmark/delta50/molecules/*.xyz
    data/benchmark/delta50/README.md
  </files>
  <action>
Download DELTA50 XYZ files from the publication's Supporting Information:
- Paper: https://www.mdpi.com/article/10.3390/molecules28062449/s1
- DOI: 10.3390/molecules28062449

The SI contains XYZ coordinate files for all 50 molecules. Download and extract to `data/benchmark/delta50/molecules/`.

Naming convention: Use sanitized IDs like `molecule_01.xyz`, `molecule_02.xyz`, etc. The exact naming from the SI is acceptable if it follows a clear pattern - just ensure consistent naming.

Create `data/benchmark/delta50/README.md` with:
- Citation: Grimblat et al., Molecules 2023, 28(6), 2449
- DOI link
- Brief description of dataset purpose
- Note that XYZ files are from publication SI

Important: If the SI provides a ZIP file, extract it. If individual files, download each. Commit all 50 XYZ files to the repository (not .gitignore).
  </action>
  <verify>
```bash
ls data/benchmark/delta50/molecules/*.xyz | wc -l  # Should be 50
head -3 data/benchmark/delta50/molecules/*.xyz | head -20  # Verify XYZ format
cat data/benchmark/delta50/README.md  # Verify citation exists
```
  </verify>
  <done>50 XYZ files exist in data/benchmark/delta50/molecules/ with proper citation in README</done>
</task>

<task type="auto">
  <name>Task 2: Parse and store experimental shifts</name>
  <files>
    data/benchmark/delta50/experimental_shifts.json
  </files>
  <action>
Extract experimental 1H and 13C chemical shifts from DELTA50 Supporting Information (Excel file in SI).

Create `data/benchmark/delta50/experimental_shifts.json` with structure:
```json
{
  "source": {
    "paper": "Grimblat et al., Molecules 2023, 28(6), 2449",
    "doi": "10.3390/molecules28062449",
    "conditions": "CDCl3, 298K"
  },
  "molecules": {
    "molecule_01": {
      "name": "Human-readable name from paper",
      "h1_shifts": [7.26, 3.45, ...],
      "c13_shifts": [128.5, 45.2, ...],
      "h1_assignments": {"1": 7.26, "2": 3.45, ...},
      "c13_assignments": {"1": 128.5, "2": 45.2, ...}
    },
    ...
  }
}
```

The assignments map atom indices (from XYZ file) to experimental shift values. If the SI doesn't provide explicit atom assignments, store shifts as ordered lists and note "assignments: unordered" in the molecule data.

Important: Parse from actual SI data. Do NOT fabricate shift values. If SI format differs from expected, adapt the JSON structure to match what's actually available.
  </action>
  <verify>
```bash
python -c "import json; d = json.load(open('data/benchmark/delta50/experimental_shifts.json')); print(f'Molecules: {len(d[\"molecules\"])}')"  # Should print 50
python -c "import json; d = json.load(open('data/benchmark/delta50/experimental_shifts.json')); m = list(d['molecules'].values())[0]; print(f'First molecule has {len(m.get(\"h1_shifts\", []))} H shifts, {len(m.get(\"c13_shifts\", []))} C shifts')"
```
  </verify>
  <done>experimental_shifts.json contains 1H and 13C data for all 50 molecules with source citation</done>
</task>

<task type="auto">
  <name>Task 3: Create benchmark module with data loader</name>
  <files>
    src/qm_nmr_calc/benchmark/__init__.py
    src/qm_nmr_calc/benchmark/models.py
    src/qm_nmr_calc/benchmark/data_loader.py
    pyproject.toml
  </files>
  <action>
Add tqdm and pandas dependencies:
```bash
uv add tqdm pandas
```

Create `src/qm_nmr_calc/benchmark/models.py`:
```python
"""Pydantic models for DELTA50 benchmark data."""
from pydantic import BaseModel

class MoleculeData(BaseModel):
    """DELTA50 molecule with experimental shifts."""
    id: str  # e.g., "molecule_01"
    name: str  # Human-readable name
    xyz_file: str  # Relative path from data/benchmark/delta50/molecules/
    h1_shifts: list[float]  # Experimental 1H shifts in ppm
    c13_shifts: list[float]  # Experimental 13C shifts in ppm
    # Optional atom assignments if available
    h1_assignments: dict[str, float] | None = None
    c13_assignments: dict[str, float] | None = None

class ExperimentalShifts(BaseModel):
    """Container for all DELTA50 experimental data."""
    source: dict[str, str]  # Paper citation info
    molecules: dict[str, MoleculeData]

class BenchmarkResult(BaseModel):
    """Single benchmark calculation result."""
    molecule_id: str
    functional: str
    basis_set: str
    solvent: str
    calculated_h1: list[float]  # Calculated 1H shifts
    calculated_c13: list[float]  # Calculated 13C shifts
    h1_mae: float | None = None  # MAE vs experimental (if available)
    c13_mae: float | None = None
    status: str = "complete"  # "complete", "failed", "skipped"
    error: str | None = None
```

Create `src/qm_nmr_calc/benchmark/data_loader.py`:
```python
"""Load DELTA50 benchmark data from repository files."""
from pathlib import Path
import json
from qm_nmr_calc.nwchem import load_geometry_file
from .models import MoleculeData, ExperimentalShifts

def get_data_dir() -> Path:
    """Get path to benchmark data directory."""
    # Relative to this file: src/qm_nmr_calc/benchmark -> data/benchmark
    return Path(__file__).parent.parent.parent.parent / "data" / "benchmark" / "delta50"

def load_experimental_shifts() -> ExperimentalShifts:
    """Load experimental shifts from JSON file."""
    shifts_file = get_data_dir() / "experimental_shifts.json"
    with shifts_file.open() as f:
        data = json.load(f)

    molecules = {}
    for mol_id, mol_data in data["molecules"].items():
        molecules[mol_id] = MoleculeData(
            id=mol_id,
            name=mol_data["name"],
            xyz_file=f"molecules/{mol_id}.xyz",
            h1_shifts=mol_data.get("h1_shifts", []),
            c13_shifts=mol_data.get("c13_shifts", []),
            h1_assignments=mol_data.get("h1_assignments"),
            c13_assignments=mol_data.get("c13_assignments"),
        )

    return ExperimentalShifts(source=data["source"], molecules=molecules)

def load_delta50_molecules() -> dict[str, tuple]:
    """Load all 50 DELTA50 molecules from XYZ files.

    Returns:
        Dict mapping molecule_id to (RDKit Mol, XYZ block) tuple
    """
    xyz_dir = get_data_dir() / "molecules"
    molecules = {}

    for xyz_file in sorted(xyz_dir.glob("*.xyz")):
        molecule_id = xyz_file.stem
        mol, xyz_block = load_geometry_file(xyz_file, charge=0)
        molecules[molecule_id] = (mol, xyz_block)

    return molecules
```

Create `src/qm_nmr_calc/benchmark/__init__.py`:
```python
"""DELTA50 benchmark infrastructure for NMR shift validation."""
from .models import MoleculeData, ExperimentalShifts, BenchmarkResult
from .data_loader import load_delta50_molecules, load_experimental_shifts, get_data_dir

__all__ = [
    "MoleculeData",
    "ExperimentalShifts",
    "BenchmarkResult",
    "load_delta50_molecules",
    "load_experimental_shifts",
    "get_data_dir",
]
```
  </action>
  <verify>
```bash
# Test imports
python -c "from qm_nmr_calc.benchmark import load_delta50_molecules, load_experimental_shifts; print('Imports OK')"

# Test data loading
python -c "from qm_nmr_calc.benchmark import load_experimental_shifts; shifts = load_experimental_shifts(); print(f'Loaded {len(shifts.molecules)} molecules')"

# Test molecule loading (may take a moment for RDKit)
python -c "from qm_nmr_calc.benchmark import load_delta50_molecules; mols = load_delta50_molecules(); print(f'Loaded {len(mols)} molecules')"
```
  </verify>
  <done>benchmark module exists with models.py and data_loader.py, both load functions work</done>
</task>

</tasks>

<verification>
After all tasks complete:

```bash
# Verify data files
ls -la data/benchmark/delta50/molecules/*.xyz | wc -l  # 50 files
cat data/benchmark/delta50/README.md | head -5  # Citation visible

# Verify JSON structure
python -c "
import json
with open('data/benchmark/delta50/experimental_shifts.json') as f:
    data = json.load(f)
print(f'Source: {data[\"source\"][\"doi\"]}')
print(f'Molecules: {len(data[\"molecules\"])}')
"

# Verify Python module
python -c "
from qm_nmr_calc.benchmark import load_delta50_molecules, load_experimental_shifts
shifts = load_experimental_shifts()
mols = load_delta50_molecules()
print(f'Experimental: {len(shifts.molecules)} molecules')
print(f'Structures: {len(mols)} molecules')
assert len(shifts.molecules) == 50, 'Expected 50 molecules in shifts'
assert len(mols) == 50, 'Expected 50 molecule structures'
print('All checks passed!')
"
```
</verification>

<success_criteria>
1. 50 XYZ files exist in data/benchmark/delta50/molecules/
2. experimental_shifts.json has data for all 50 molecules
3. load_delta50_molecules() returns 50 (mol, xyz_block) tuples
4. load_experimental_shifts() returns ExperimentalShifts with 50 molecules
5. README.md contains proper DELTA50 citation
</success_criteria>

<output>
After completion, create `.planning/phases/08-delta50-setup/08-01-SUMMARY.md`
</output>
