---
phase: 17-api-integration
task: 0
total_tasks: TBD
status: not_started
last_updated: 2026-01-28
---

<current_state>
Phase 16 (CREST Integration) just completed and verified. Phase 17 (API Integration) is next.

Phase 17 has not been planned yet — no PLAN.md files exist. First step is `/gsd:discuss-phase 17` or `/gsd:plan-phase 17`.
</current_state>

<completed_work>
**This session:**
- Executed Phase 16 (CREST Integration) — all 3 plans
  - 16-01: CREST detection, ALPB solvent mapping, multi-XYZ parsing
  - 16-02: CREST subprocess runner with timeout and ensemble builder
  - 16-03: Pipeline dispatch, health endpoint, integration tests
- Phase 16 verified: 5/5 must-haves passed
- Requirements CONF-04 and CONF-05 marked complete
- 262 tests passing (33 new in Phase 16)

**Also this session:**
- Installed Tailscale for VPN-free access to server
- Server hostname: sheldon
- Tailscale IP: 100.106.16.111
</completed_work>

<remaining_work>
**Phase 17: API Integration and Progress Tracking**

Goal: User-facing ensemble mode with conformer selection, metadata, and progress updates

Success criteria from ROADMAP.md:
1. User can choose between single-conformer mode (v1.x) and ensemble mode when submitting job
2. User can choose RDKit KDG or CREST as conformer generation method in ensemble mode
3. API returns Boltzmann-weighted average shifts (not per-conformer detail)
4. API response includes ensemble metadata (conformer count, energy range, top 3 populations, method used, temperature)
5. 3D viewer shows lowest-energy conformer geometry with shift labels
6. Job status includes ensemble-specific states (generating_conformers, optimizing_conformers X/N, calculating_nmr X/N, averaging_shifts)
7. Web UI displays conformer progress for ensemble jobs

Requirements to complete: CONF-01, CONF-02, API-01, API-02, API-03, PROG-01, PROG-02

Phase 17 is the **last phase** of v2.0 milestone.
</remaining_work>

<decisions_made>
**Phase 16 decisions (now complete):**
- conformer_method parameter for dispatch: "rdkit_kdg" (default) or "crest"
- CREST as informational health field: Non-blocking capability reporting
- Fail-fast validation: Clear errors for CREST unavailable, vacuum, unsupported solvents

**Key concern for Phase 17:**
- Ensemble filtering before averaging: `average_ensemble_nmr` requires `len(conformers) == len(nmr_results)`. The Huey task (Phase 17) must filter ensemble to only nmr_complete conformers before calling averaging function.
</decisions_made>

<blockers>
None.
</blockers>

<context>
v2.0 Conformational Sampling milestone is 5/6 phases complete (12-16). Phase 17 is the final integration phase that exposes all the backend functionality through the API and web UI.

The backend is fully functional:
- RDKit KDG conformer generation
- CREST conformer generation (when available)
- DFT optimization per conformer
- NMR calculation per conformer
- Boltzmann averaging
- Energy window filtering (pre-DFT and post-DFT)

Phase 17 wires this into the user-facing API and adds progress tracking.
</context>

<next_action>
Start with: `/gsd:discuss-phase 17` to gather context and clarify the API design approach, OR `/gsd:plan-phase 17` to jump straight to planning.

The phase will likely need 3-5 plans covering:
- Huey task updates for ensemble mode
- API endpoint updates (conformer_mode, conformer_method parameters)
- Job status schema updates (ensemble states, metadata)
- Web UI progress display
- Integration tests
</next_action>
