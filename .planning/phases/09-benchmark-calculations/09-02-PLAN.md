---
phase: 09-benchmark-calculations
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - data/benchmark/results/status.json
  - data/benchmark/results/compound_*/*/shifts.json
  - .planning/phases/09-benchmark-calculations/BENCHMARK-RESULTS.md
autonomous: false

must_haves:
  truths:
    - "Pilot run (5 molecules, 20 calculations) completes successfully"
    - "Full run (200 total calculations) completes or pauses at threshold"
    - "Results directory contains shifts.json for each completed calculation"
    - "BENCHMARK-RESULTS.md summarizes completion status"
  artifacts:
    - path: "data/benchmark/results/status.json"
      provides: "Final benchmark status"
      contains: "state|completed|total_tasks"
    - path: ".planning/phases/09-benchmark-calculations/BENCHMARK-RESULTS.md"
      provides: "Human-readable summary report"
      min_lines: 20
  key_links:
    - from: "data/benchmark/results/compound_*/*/shifts.json"
      to: "experimental_shifts.json"
      via: "molecule_id correspondence"
      pattern: "compound_\\d+"
---

<objective>
Execute DELTA50 benchmark calculations (200 total) with pilot validation

Purpose: Generate calculated NMR shifts for all 50 DELTA50 molecules with B3LYP and WP04 functionals in CHCl3 and DMSO solvents
Output: 200 shifts.json files, status.json showing completion, BENCHMARK-RESULTS.md summary
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-benchmark-calculations/09-CONTEXT.md
@.planning/phases/09-benchmark-calculations/09-RESEARCH.md
@.planning/phases/09-benchmark-calculations/09-01-SUMMARY.md
@src/qm_nmr_calc/benchmark/runner.py
@src/qm_nmr_calc/benchmark/__main__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Execute pilot run (5 molecules, 20 calculations)</name>
  <files>data/benchmark/results/</files>
  <action>
Run pilot benchmark to validate pipeline before committing to full run:

1. **Execute pilot with first 5 molecules:**
   ```bash
   python -m qm_nmr_calc.benchmark run \
     --molecules compound_01 compound_02 compound_03 compound_04 compound_05 \
     --processes 4
   ```

2. **Verify pilot results:**
   - Check status: `python -m qm_nmr_calc.benchmark status`
   - Expect: 20/200 completed (or 20 completed with some failed)
   - Verify shifts.json files exist for each completed calculation
   - Sample check: `cat data/benchmark/results/compound_01/B3LYP_CHCl3/shifts.json | head -20`

3. **Validate shifts look reasonable:**
   - 1H shifts should be in range 0-15 ppm (typical organic molecules)
   - 13C shifts should be in range 0-220 ppm
   - Compare shift counts to atom counts in XYZ files

4. **If pilot has failures:**
   - Document which molecule/functional/solvent combinations failed
   - Check error messages in status.json
   - If >2 failures (40% of pilot), STOP and investigate before continuing
   - If <=2 failures, note them and proceed (some molecule-specific issues expected)

This is an interactive pilot run. Do NOT use --headless for pilot.
  </action>
  <verify>
`python -m qm_nmr_calc.benchmark status` shows:
- At least 15/200 completed (allowing for some failures)
- Pilot molecules have shifts.json files
  </verify>
  <done>
- Pilot run executed (5 molecules, 20 calculations attempted)
- Results validated: shifts in expected ranges
- Any failures documented
- Ready to proceed with full run
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Pilot run completed with 5 DELTA50 molecules (20 calculations)</what-built>
  <how-to-verify>
1. Check pilot results:
   ```bash
   python -m qm_nmr_calc.benchmark status
   ```

2. Verify sample output looks reasonable:
   ```bash
   cat data/benchmark/results/compound_01/B3LYP_CHCl3/shifts.json | python -m json.tool | head -30
   ```

3. Confirm ready to proceed with full headless run (will take 20-30 hours)
  </how-to-verify>
  <resume-signal>
Type "proceed" to continue with full headless run, or describe any issues found
  </resume-signal>
</task>

<task type="auto">
  <name>Task 2: Execute full headless run (remaining 180 calculations)</name>
  <files>data/benchmark/results/</files>
  <action>
Launch full benchmark run in headless mode:

1. **Clear any existing STOP file:**
   ```bash
   rm -f data/benchmark/results/STOP
   ```

2. **Launch headless benchmark:**
   ```bash
   nohup python -m qm_nmr_calc.benchmark run --headless --processes 8 > /dev/null 2>&1 &
   echo "Benchmark started with PID: $!"
   ```

   Note: Uses --processes 8 for faster execution on multi-core machine. Adjust if needed.

3. **Verify it started:**
   ```bash
   sleep 5
   python -m qm_nmr_calc.benchmark status
   ```
   Should show state: "running" with progress incrementing.

4. **Provide monitoring instructions:**
   - Check progress: `python -m qm_nmr_calc.benchmark status`
   - View log: `tail -f data/benchmark/results/benchmark.log`
   - Stop gracefully: `python -m qm_nmr_calc.benchmark stop`

5. **Document estimated completion time:**
   - Based on pilot timing, estimate total run time
   - Example: If pilot (20 calcs) took 1 hour, full run (200 calcs) ~ 10 hours

The full run will continue independently. Claude does not need to wait for completion.
Resume support means the run can be checked/continued in a new session.
  </action>
  <verify>
`python -m qm_nmr_calc.benchmark status` shows:
- state: "running"
- completed count increasing
- current_task populated
  </verify>
  <done>
- Full headless run launched
- PID noted
- Monitoring instructions provided
- Estimated completion time documented
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full benchmark run launched in headless mode</what-built>
  <how-to-verify>
The benchmark is now running independently. You can:

1. **Check progress anytime:**
   ```bash
   python -m qm_nmr_calc.benchmark status
   ```

2. **Wait for completion** (may take 10-30 hours depending on hardware)

3. **When complete**, status will show `state: "complete"` or `state: "paused"` (if threshold hit)

Please type "complete" when the benchmark finishes (or "paused" if it stopped due to failures).

If you need to stop early: `python -m qm_nmr_calc.benchmark stop`
  </how-to-verify>
  <resume-signal>
Type "complete" when benchmark finishes, "paused" if stopped at failure threshold, or describe status
  </resume-signal>
</task>

<task type="auto">
  <name>Task 3: Generate BENCHMARK-RESULTS.md summary report</name>
  <files>.planning/phases/09-benchmark-calculations/BENCHMARK-RESULTS.md</files>
  <action>
Create summary report of benchmark execution:

1. **Gather final statistics:**
   - Read status.json for completion stats
   - Run `python -m qm_nmr_calc.benchmark summary` to generate CSV
   - Count results per functional/solvent combination

2. **Create BENCHMARK-RESULTS.md with sections:**

```markdown
# DELTA50 Benchmark Results

**Execution Date:** {date}
**Total Duration:** {hours} hours

## Summary

| Metric | Value |
|--------|-------|
| Total Calculations | 200 |
| Completed | {N} |
| Failed | {N} |
| Success Rate | {X}% |

## Results by Method

| Functional | Solvent | Completed | Failed |
|------------|---------|-----------|--------|
| B3LYP | CHCl3 | X | Y |
| B3LYP | DMSO | X | Y |
| WP04 | CHCl3 | X | Y |
| WP04 | DMSO | X | Y |

## Failures (if any)

{List each failure with molecule_id, functional, solvent, error message}

## Data Location

Results stored in: `data/benchmark/results/`
- Each molecule: `compound_XX/{FUNCTIONAL}_{SOLVENT}/shifts.json`
- Summary CSV: `data/benchmark/results/summary.csv`

## Next Steps

Phase 10 will use these results to derive scaling factors via linear regression.
```

3. **Validate report completeness:**
   - All 4 functional/solvent combinations reported
   - Failure details included if any
   - Ready for Phase 10 scaling factor derivation
  </action>
  <verify>
- BENCHMARK-RESULTS.md exists in phase directory
- Contains completion statistics
- Lists any failures with error details
  </verify>
  <done>
- BENCHMARK-RESULTS.md created with full summary
- All completed calculations documented
- Failures analyzed (if any)
- Ready for Phase 10
  </done>
</task>

</tasks>

<verification>
- [ ] Pilot run completed (5 molecules, 20 calculations)
- [ ] Full run completed or documented at threshold pause
- [ ] status.json shows final state (complete/stopped/paused)
- [ ] BENCHMARK-RESULTS.md summarizes execution
- [ ] Results ready for Phase 10 scaling factor derivation
</verification>

<success_criteria>
DELTA50 benchmark execution complete:
- All 200 calculations attempted (or documented why not)
- shifts.json files exist for completed calculations
- Failures documented with error analysis
- Summary report generated
- Data ready for scaling factor derivation in Phase 10
</success_criteria>

<output>
After completion, create `.planning/phases/09-benchmark-calculations/09-02-SUMMARY.md`
</output>
