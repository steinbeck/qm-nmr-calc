# Docker Compose GCP overrides for qm-nmr-calc
# HTTP-only deployment with persistent disk storage (no Caddy/HTTPS)
#
# Usage: docker compose -f docker-compose.yml -f docker-compose.gcp.yml up -d
#
# This override file is automatically created by the startup script and configures:
# - Persistent disk bind mounts (/mnt/disks/data instead of named volume)
# - Production environment variables
# - Caddy disabled (HTTP-only, API serves directly on port 80)

services:
  init:
    volumes:
      - /mnt/disks/data:/app/data

  api:
    volumes:
      - /mnt/disks/data:/app/data
    environment:
      - ENVIRONMENT=production
      - LOG_LEVEL=info
    ports:
      - "80:8000"

  worker:
    volumes:
      - /mnt/disks/data:/app/data
    environment:
      - ENVIRONMENT=production
      - LOG_LEVEL=info
      - NWCHEM_NPROC=${NWCHEM_NPROC}
    deploy:
      resources:
        limits:
          memory: ${WORKER_MEMORY_LIMIT:-120g}

  # Disable Caddy â€” move to inactive profile so it never starts
  # (HTTP-only deployment, API serves directly on port 80)
  caddy:
    profiles:
      - caddy-enabled
